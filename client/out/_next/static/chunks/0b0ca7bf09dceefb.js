(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,8056,e=>{"use strict";var s=e.i(49973),a=e.i(18939),t=e.i(91514),r=e.i(13622),i=e.i(69742),n=e.i(27341),l=e.i(67881),o=e.i(91967),c=e.i(44977),d=e.i(56207),m=e.i(34643);function x(e){let s=a.useRef({value:e,previous:e});return a.useMemo(()=>(s.current.value!==e&&(s.current.previous=s.current.value,s.current.value=e),s.current.previous),[e])}var u=e.i(53233),p=e.i(56872),h="Switch",[g,j]=(0,d.createContextScope)(h),[f,b]=g(h),v=a.forwardRef((e,t)=>{let{__scopeSwitch:r,name:i,checked:n,defaultChecked:l,required:d,disabled:x,value:u="on",onCheckedChange:g,form:j,...b}=e,[v,N]=a.useState(null),y=(0,c.useComposedRefs)(t,e=>N(e)),C=a.useRef(!1),k=!v||j||!!v.closest("form"),[E,S]=(0,m.useControllableState)({prop:n,defaultProp:l??!1,onChange:g,caller:h});return(0,s.jsxs)(f,{scope:r,checked:E,disabled:x,children:[(0,s.jsx)(p.Primitive.button,{type:"button",role:"switch","aria-checked":E,"aria-required":d,"data-state":_(E),"data-disabled":x?"":void 0,disabled:x,value:u,...b,ref:y,onClick:(0,o.composeEventHandlers)(e.onClick,e=>{S(e=>!e),k&&(C.current=e.isPropagationStopped(),C.current||e.stopPropagation())})}),k&&(0,s.jsx)(w,{control:v,bubbles:!C.current,name:i,value:u,checked:E,required:d,disabled:x,form:j,style:{transform:"translateX(-100%)"}})]})});v.displayName=h;var N="SwitchThumb",y=a.forwardRef((e,a)=>{let{__scopeSwitch:t,...r}=e,i=b(N,t);return(0,s.jsx)(p.Primitive.span,{"data-state":_(i.checked),"data-disabled":i.disabled?"":void 0,...r,ref:a})});y.displayName=N;var w=a.forwardRef(({__scopeSwitch:e,control:t,checked:r,bubbles:i=!0,...n},l)=>{let o=a.useRef(null),d=(0,c.useComposedRefs)(o,l),m=x(r),p=(0,u.useSize)(t);return a.useEffect(()=>{let e=o.current;if(!e)return;let s=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(m!==r&&s){let a=new Event("click",{bubbles:i});s.call(e,r),e.dispatchEvent(a)}},[m,r,i]),(0,s.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...n,tabIndex:-1,ref:d,style:{...n.style,...p,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function _(e){return e?"checked":"unchecked"}w.displayName="SwitchBubbleInput";var C=e.i(47163);function k({className:e,...a}){return(0,s.jsx)(v,{"data-slot":"switch",className:(0,C.cn)("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",e),...a,children:(0,s.jsx)(y,{"data-slot":"switch-thumb",className:(0,C.cn)("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}var E=e.i(10708),S=e.i(54754),A=e.i(63745),q=e.i(98631);let I=(0,q.default)("pen-line",[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);var P=e.i(50601);let O=(0,q.default)("folder-plus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);var T=e.i(29126),B=e.i(66974),F=e.i(7474),R=e.i(70856);e.i(8419);var M=e.i(12507),G=e.i(7112),X=e.i(96524),D=e.i(64583),L=e.i(4370),$=e.i(94179),z=e.i(39863);let U=(0,q.default)("file-code",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 12.5 8 15l2 2.5",key:"1tg20x"}],["path",{d:"m14 12.5 2 2.5-2 2.5",key:"yinavb"}]]);var V=e.i(49202);let H=(0,q.default)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);var Q=e.i(64473);let K=(0,q.default)("file-type",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M11 18h2",key:"12mj7e"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"M9 13v-.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 .5.5v.5",key:"qbrxap"}]]);var J=e.i(21172),W=e.i(39257),Z=e.i(83509),Y=e.i(72200);let ee=(0,q.default)("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);var es=e.i(56625),ea=e.i(31016),et=e.i(52512),er=e.i(15682),ei=e.i(18133),en=e.i(94294),el=e.i(74515),eo=e.i(98281),ec=e.i(53668);function ed({confidence:e,className:a}){let t=Math.round(100*e);return(0,s.jsxs)("div",{className:(0,C.cn)("flex items-center gap-2",a),children:[(0,s.jsx)("div",{className:"flex-1 h-1.5 bg-white/10 rounded-full overflow-hidden",children:(0,s.jsx)("div",{className:(0,C.cn)("h-full rounded-full transition-all",t>=80?"bg-green-500":t>=50?"bg-yellow-500":"bg-red-500"),style:{width:`${t}%`}})}),(0,s.jsxs)("span",{className:"text-xs text-text-secondary w-10",children:[t,"%"]})]})}function em({source:e}){let{label:a,icon:t,className:r}={memory_pattern:{label:"Padrão",icon:eo.History,className:"bg-purple-500/20 text-purple-300 border-purple-500/30"},documentation:{label:"Docs",icon:el.BookOpen,className:"bg-blue-500/20 text-blue-300 border-blue-500/30"},inference:{label:"Inferência",icon:ei.Lightbulb,className:"bg-yellow-500/20 text-yellow-300 border-yellow-500/30"}}[e];return(0,s.jsxs)($.Badge,{variant:"outline",className:(0,C.cn)("text-xs",r),children:[(0,s.jsx)(t,{className:"w-3 h-3 mr-1"}),a]})}function ex({action:e}){let{label:a,icon:t,className:r}={retry:{label:"Tentar Novamente",icon:B.RefreshCw,className:"bg-green-500/20 text-green-300 border-green-500/30"},fallback:{label:"Alternativa",icon:et.ArrowRight,className:"bg-yellow-500/20 text-yellow-300 border-yellow-500/30"},escalate:{label:"Escalar",icon:J.AlertTriangle,className:"bg-orange-500/20 text-orange-300 border-orange-500/30"},abort:{label:"Abortar",icon:ec.XCircle,className:"bg-red-500/20 text-red-300 border-red-500/30"}}[e];return(0,s.jsxs)($.Badge,{variant:"outline",className:(0,C.cn)("text-xs",r),children:[(0,s.jsx)(t,{className:"w-3 h-3 mr-1"}),a]})}function eu({title:e,icon:t,children:n,defaultExpanded:l=!1,count:o}){let[c,d]=(0,a.useState)(l);return(0,s.jsxs)("div",{className:"border-t border-white/10 pt-3 mt-3",children:[(0,s.jsxs)("button",{onClick:()=>d(!c),className:"flex items-center justify-between w-full text-left group",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(t,{className:"w-4 h-4 text-primary-400"}),(0,s.jsx)("span",{className:"text-sm font-medium text-text-primary",children:e}),void 0!==o&&(0,s.jsx)($.Badge,{variant:"secondary",className:"text-xs",children:o})]}),c?(0,s.jsx)(ee,{className:"w-4 h-4 text-text-secondary group-hover:text-text-primary transition-colors"}):(0,s.jsx)(Y.ChevronDown,{className:"w-4 h-4 text-text-secondary group-hover:text-text-primary transition-colors"})]}),(0,s.jsx)(r.AnimatePresence,{children:c&&(0,s.jsx)(i.motion.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:(0,s.jsx)("div",{className:"pt-3",children:n})})})]})}function ep({causes:e}){return(0,s.jsx)("div",{className:"space-y-3",children:e.map((e,a)=>(0,s.jsxs)("div",{className:"p-3 rounded-lg bg-white/5 border border-white/10",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between gap-2 mb-2",children:[(0,s.jsx)("span",{className:"text-sm text-text-primary flex-1",children:e.cause}),(0,s.jsx)(em,{source:e.source})]}),(0,s.jsx)(ed,{confidence:e.confidence,className:"mb-2"}),e.evidence.length>0&&(0,s.jsxs)("div",{className:"mt-2 pt-2 border-t border-white/5",children:[(0,s.jsx)("span",{className:"text-xs text-text-secondary block mb-1",children:"Evidências:"}),(0,s.jsx)("ul",{className:"list-disc list-inside text-xs text-text-secondary space-y-0.5",children:e.evidence.map((e,a)=>(0,s.jsx)("li",{children:e},a))})]})]},a))})}function eh({steps:e}){return(0,s.jsx)("ol",{className:"list-decimal list-inside space-y-2",children:e.map((e,a)=>(0,s.jsx)("li",{className:"text-sm text-text-secondary",children:(0,s.jsx)("span",{className:"ml-1",children:e})},a))})}function eg({links:e}){return(0,s.jsx)("div",{className:"space-y-2",children:e.map((e,a)=>(0,s.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-start gap-2 p-2 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 hover:border-primary-500/50 transition-colors group",children:[(0,s.jsx)(V.FileText,{className:"w-4 h-4 text-primary-400 mt-0.5 shrink-0"}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("span",{className:"text-sm text-text-primary block truncate group-hover:text-primary-300 transition-colors",children:e.title}),(0,s.jsx)("span",{className:"text-xs text-text-secondary",children:e.relevance})]}),(0,s.jsx)(er.ExternalLink,{className:"w-3 h-3 text-text-secondary group-hover:text-primary-400 transition-colors shrink-0"})]},a))})}function ej({patterns:e}){return(0,s.jsx)("div",{className:"space-y-2",children:e.map((e,a)=>(0,s.jsxs)("div",{className:"p-3 rounded-lg bg-white/5 border border-white/10",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-xs text-text-secondary font-mono",children:e.pattern_id}),(0,s.jsxs)($.Badge,{variant:"outline",className:"text-xs",children:[Math.round(100*e.similarity),"% similar"]})]}),(0,s.jsx)("p",{className:"text-sm text-text-primary",children:e.resolution})]},a))})}function ef({analysis:e,onAction:t,className:n,defaultExpanded:o=!0}){let[c,d]=(0,a.useState)(o),m={retry:{label:"Tentar Novamente",icon:B.RefreshCw,variant:"default"},fallback:{label:"Usar Alternativa",icon:et.ArrowRight,variant:"secondary"},escalate:{label:"Escalar para Suporte",icon:J.AlertTriangle,variant:"secondary"},abort:{label:"Cancelar Operação",icon:ec.XCircle,variant:"destructive"}}[e.suggested_action];return(0,s.jsxs)(L.GlassCard,{className:(0,C.cn)("border-red-500/30",n),elevated:!0,padding:"md",children:[(0,s.jsxs)(L.GlassCardHeader,{children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(es.AlertCircle,{className:"w-5 h-5 text-red-400"}),(0,s.jsx)(L.GlassCardTitle,{className:"text-base",children:"Análise de Erro"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[e.recoverable&&(0,s.jsxs)($.Badge,{variant:"outline",className:"bg-green-500/20 text-green-300 border-green-500/30",children:[(0,s.jsx)(ea.CheckCircle,{className:"w-3 h-3 mr-1"}),"Recuperável"]}),(0,s.jsx)($.Badge,{variant:"destructive",children:e.error_type}),(0,s.jsx)("button",{onClick:()=>d(!c),className:"p-1 hover:bg-white/10 rounded transition-colors",children:c?(0,s.jsx)(ee,{className:"w-4 h-4 text-text-secondary"}):(0,s.jsx)(Y.ChevronDown,{className:"w-4 h-4 text-text-secondary"})})]})]}),(0,s.jsx)(r.AnimatePresence,{children:c&&(0,s.jsx)(i.motion.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:(0,s.jsxs)(L.GlassCardContent,{children:[(0,s.jsx)("div",{className:"p-3 rounded-lg bg-red-500/10 border border-red-500/20 mb-4",children:(0,s.jsx)("p",{className:"text-sm text-text-primary leading-relaxed",children:e.technical_explanation})}),(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4 p-3 rounded-lg bg-white/5 border border-white/10",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(en.Target,{className:"w-4 h-4 text-primary-400"}),(0,s.jsx)("span",{className:"text-sm text-text-secondary",children:"Ação Recomendada:"}),(0,s.jsx)(ex,{action:e.suggested_action})]}),t&&(0,s.jsxs)(l.Button,{variant:m.variant,size:"sm",onClick:()=>t(e.suggested_action),className:"gap-1",children:[(0,s.jsx)(m.icon,{className:"w-3 h-3"}),m.label]})]}),e.root_causes.length>0&&(0,s.jsx)(eu,{title:"Possíveis Causas",icon:J.AlertTriangle,defaultExpanded:!0,count:e.root_causes.length,children:(0,s.jsx)(ep,{causes:e.root_causes})}),e.debugging_steps.length>0&&(0,s.jsx)(eu,{title:"Passos de Debug",icon:ei.Lightbulb,defaultExpanded:!0,count:e.debugging_steps.length,children:(0,s.jsx)(eh,{steps:e.debugging_steps})}),e.documentation_links.length>0&&(0,s.jsx)(eu,{title:"Documentação Relacionada",icon:el.BookOpen,defaultExpanded:!1,count:e.documentation_links.length,children:(0,s.jsx)(eg,{links:e.documentation_links})}),e.similar_patterns.length>0&&(0,s.jsx)(eu,{title:"Padrões Similares",icon:eo.History,defaultExpanded:!1,count:e.similar_patterns.length,children:(0,s.jsx)(ej,{patterns:e.similar_patterns})})]})})})]})}function eb(e){return e?({xml:"text-green-400",pdf:"text-red-400",image:"text-blue-400",csv:"text-emerald-400",xlsx:"text-emerald-400",txt:"text-yellow-400",unknown:"text-gray-400"})[e]||"text-gray-400":"text-text-muted"}function ev({isProcessing:e,progress:t,error:r,detectedType:n,onFileSelect:o,onDebugAction:c}){var d;let[m,x]=(0,a.useState)(null),[u,p]=(0,a.useState)(null),[h,g]=(0,a.useState)(!1),j=(0,a.useCallback)(e=>{x(e),p((0,Z.detectFileTypeFromFile)(e))},[]),f=async()=>{if(m)try{await o(m,null,null)}catch{}},b=(d=u||n)?({xml:U,pdf:V.FileText,image:H,csv:Q.Table,xlsx:Q.Table,txt:K,unknown:K})[d]||K:A.Upload;return(0,s.jsxs)(L.GlassCard,{children:[(0,s.jsx)(L.GlassCardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(W.Sparkles,{className:"w-4 h-4 text-magenta-mid"}),(0,s.jsx)("div",{className:"absolute -top-0.5 -right-0.5 w-2 h-2 bg-green-400 rounded-full animate-pulse"})]}),(0,s.jsx)(L.GlassCardTitle,{children:"Upload Inteligente"}),(0,s.jsxs)($.Badge,{className:"bg-gradient-to-r from-blue-mid/20 to-magenta-mid/20 text-blue-light border-none",children:[(0,s.jsx)(R.Brain,{className:"w-3 h-3 mr-1"}),"Auto-Detect"]})]})}),(0,s.jsx)(L.GlassCardContent,{children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:`
              relative border-2 border-dashed rounded-lg p-8 text-center transition-all duration-300
              ${h?"border-magenta-mid bg-magenta-mid/10 scale-[1.02]":"border-border hover:border-blue-mid/50"}
              ${e?"opacity-50 pointer-events-none":"cursor-pointer"}
            `,onDragOver:e=>{e.preventDefault(),g(!0)},onDragLeave:e=>{e.preventDefault(),g(!1)},onDrop:e=>{e.preventDefault(),g(!1);let s=e.dataTransfer.files?.[0];s&&j(s)},children:[(0,s.jsx)("input",{type:"file",accept:Z.SMART_IMPORT_FORMATS.accept,onChange:e=>{let s=e.target.files?.[0];s&&j(s)},className:"hidden",id:"smart-upload",disabled:e}),(0,s.jsxs)("label",{htmlFor:"smart-upload",className:"cursor-pointer",children:[(0,s.jsx)(i.motion.div,{className:`mx-auto mb-4 w-16 h-16 rounded-full flex items-center justify-center ${m?"bg-gradient-to-br from-blue-mid/20 to-magenta-mid/20":"bg-white/5"}`,animate:{scale:h?1.1:1},transition:{duration:.2},children:(0,a.createElement)(b,{className:`w-8 h-8 ${eb(u)}`})}),m?(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-text-primary mb-1",children:m.name}),(0,s.jsx)($.Badge,{className:`${eb(u)} bg-white/10 border-none`,children:(0,Z.getFileTypeLabel)(u||"unknown")})]}):(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-text-primary mb-1",children:"Arraste seu arquivo aqui ou clique para selecionar"}),(0,s.jsx)("p",{className:"text-xs text-text-muted",children:"Formatos aceitos: XML, PDF, CSV, XLSX, JPG, PNG, TXT"})]})]}),(0,s.jsxs)("div",{className:"flex justify-center gap-3 mt-4 opacity-50",children:[(0,s.jsx)(U,{className:"w-4 h-4","aria-label":"XML"}),(0,s.jsx)(V.FileText,{className:"w-4 h-4","aria-label":"PDF"}),(0,s.jsx)(Q.Table,{className:"w-4 h-4","aria-label":"CSV/XLSX"}),(0,s.jsx)(H,{className:"w-4 h-4","aria-label":"JPG/PNG"}),(0,s.jsx)(K,{className:"w-4 h-4","aria-label":"TXT"})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-gradient-to-r from-blue-mid/10 to-magenta-mid/10 rounded-lg border border-blue-mid/20",children:[(0,s.jsx)(R.Brain,{className:"w-5 h-5 text-magenta-mid"}),(0,s.jsxs)("div",{className:"text-xs text-text-muted",children:[(0,s.jsx)("p",{className:"font-medium text-text-secondary mb-0.5",children:"Processamento Inteligente"}),(0,s.jsx)("p",{children:"O sistema detecta automaticamente o tipo de arquivo e roteia para o agente apropriado (IntakeAgent para NF, ImportAgent para planilhas e texto)."})]})]}),e&&(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(B.RefreshCw,{className:"w-4 h-4 animate-spin text-blue-light"}),(0,s.jsx)("span",{className:"text-text-muted",children:t.message})]}),(0,s.jsxs)("span",{className:"text-text-primary font-medium",children:[t.percent,"%"]})]}),(0,s.jsx)("div",{className:"h-2 bg-white/10 rounded-full overflow-hidden",children:(0,s.jsx)(i.motion.div,{className:`h-full bg-gradient-to-r ${function(e){switch(e){case"detecting":return"from-purple-500 to-blue-500";case"uploading":return"from-blue-500 to-cyan-500";case"processing":return"from-cyan-500 to-green-500";case"complete":return"from-green-500 to-green-400";case"error":return"from-red-500 to-red-400";default:return"from-gray-500 to-gray-400"}}(t.stage)} rounded-full`,initial:{width:0},animate:{width:`${t.percent}%`},transition:{duration:.3}})}),n&&(0,s.jsxs)("p",{className:"text-xs text-center text-text-muted",children:["Tipo detectado: ",(0,s.jsx)("span",{className:eb(n),children:(0,Z.getFileTypeLabel)(n)})]})]}),r&&(r.debug_analysis?(0,s.jsx)(ef,{analysis:r.debug_analysis,onAction:c,defaultExpanded:!0,className:"mt-2"}):(0,s.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-red-500/20 border border-red-500/30 rounded-lg",children:[(0,s.jsx)(J.AlertTriangle,{className:"w-5 h-5 text-red-400"}),(0,s.jsx)("p",{className:"text-sm text-red-400",children:r.message})]})),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(l.Button,{className:"w-full bg-gradient-to-r from-blue-mid to-magenta-mid hover:from-blue-mid/80 hover:to-magenta-mid/80 text-white",disabled:!m||e,onClick:f,children:e?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(B.RefreshCw,{className:"w-4 h-4 mr-2 animate-spin"}),"Processando..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(z.FileUp,{className:"w-4 h-4 mr-2"}),"Processar Arquivo"]})}),!e&&!m&&(0,s.jsxs)("p",{className:"text-xs text-center text-amber-400",children:[(0,s.jsx)(J.AlertTriangle,{className:"w-3 h-3 inline mr-1"}),"Selecione um arquivo para processar"]})]})]})})]})}var eN=e.i(9020),ey=e.i(70710),ew=e.i(71628),e_=e.i(84033);function eC({preview:e,onConfirm:a,onCancel:t,isConfirming:r=!1}){var n;let{extraction:o,confidence_score:c}=e,d=(0,Z.requiresHILReview)(e),m={nf_xml:"XML",nf_pdf:"PDF",nf_image:"Imagem (OCR)"}[e.source_type]||"Desconhecido";return(0,s.jsxs)(L.GlassCard,{children:[(0,s.jsx)(L.GlassCardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(V.FileText,{className:"w-4 h-4 text-blue-light"}),(0,s.jsx)(L.GlassCardTitle,{children:"Dados Extraidos"}),(0,s.jsx)($.Badge,{variant:"outline",className:"text-xs",children:m})]}),c&&(0,s.jsxs)($.Badge,{className:(n=c.overall)>=.9?"bg-green-500/20 text-green-400":n>=.7?"bg-yellow-500/20 text-yellow-400":"bg-red-500/20 text-red-400",children:["Confianca: ",Math.round(100*c.overall),"%"]})]})}),(0,s.jsx)(L.GlassCardContent,{children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 p-4 bg-white/5 rounded-lg",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-1 text-xs text-text-muted mb-1",children:[(0,s.jsx)(e_.Hash,{className:"w-3 h-3"}),"Numero NF"]}),(0,s.jsx)("p",{className:"text-sm font-medium text-text-primary",children:o.nf_number||"-"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"flex items-center gap-1 text-xs text-text-muted mb-1",children:"Serie"}),(0,s.jsx)("p",{className:"text-sm font-medium text-text-primary",children:o.nf_series||"-"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-1 text-xs text-text-muted mb-1",children:[(0,s.jsx)(ey.Building2,{className:"w-3 h-3"}),"Fornecedor"]}),(0,s.jsx)("p",{className:"text-sm font-medium text-text-primary truncate",children:o.supplier_name||"-"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-1 text-xs text-text-muted mb-1",children:[(0,s.jsx)(ew.Calendar,{className:"w-3 h-3"}),"Data Emissao"]}),(0,s.jsx)("p",{className:"text-sm font-medium text-text-primary",children:o.issue_date?new Date(o.issue_date).toLocaleDateString("pt-BR"):"-"})]})]}),o.extraction_warnings&&o.extraction_warnings.length>0&&(0,s.jsxs)("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg",children:[(0,s.jsx)("p",{className:"text-xs font-medium text-yellow-400 mb-2",children:"Avisos da Extracao:"}),(0,s.jsx)("ul",{className:"text-xs text-yellow-400/80 space-y-1",children:o.extraction_warnings.map((e,a)=>(0,s.jsxs)("li",{children:["- ",e]},a))})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h4",{className:"text-sm font-medium text-text-primary mb-3 flex items-center gap-2",children:[(0,s.jsx)(eN.Package,{className:"w-4 h-4 text-blue-light"}),"Itens (",o.items?.length||0,")"]}),(0,s.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:(o.items||[]).map((e,a)=>(0,s.jsxs)(i.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.05*a},className:"flex items-center gap-4 p-3 bg-white/5 rounded-lg hover:bg-white/10 transition-colors",children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-lg bg-blue-mid/20 flex items-center justify-center shrink-0",children:(0,s.jsx)(eN.Package,{className:"w-4 h-4 text-blue-light"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-sm text-text-primary truncate",children:e.description}),(0,s.jsxs)("p",{className:"text-xs text-text-muted",children:["Codigo: ",e.product_code||"-"," | NCM: ",e.ncm_code||"-"]})]}),(0,s.jsxs)("div",{className:"text-right shrink-0",children:[(0,s.jsxs)("p",{className:"text-sm font-medium text-text-primary",children:["Qtd: ",e.quantity," ",e.unit_of_measure]}),(0,s.jsxs)("p",{className:"text-xs text-text-muted",children:["R$ ",e.unit_value?.toFixed(2)||"0.00"]})]})]},a))})]}),o.total_value&&(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-blue-mid/10 to-magenta-mid/10 rounded-lg",children:[(0,s.jsx)("span",{className:"text-sm text-text-muted",children:"Valor Total da NF"}),(0,s.jsxs)("span",{className:"text-lg font-bold text-text-primary",children:["R$ ",o.total_value.toFixed(2)]})]}),d&&(0,s.jsxs)("div",{className:"flex items-start gap-3 p-4 bg-yellow-500/20 border border-yellow-500/30 rounded-lg",children:[(0,s.jsx)(J.AlertTriangle,{className:"w-5 h-5 text-yellow-400 mt-0.5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-yellow-400",children:"Revisao Necessaria"}),(0,s.jsx)("p",{className:"text-xs text-yellow-400/80 mt-1",children:"A confianca da extracao esta abaixo do limite. Por favor, revise os dados antes de confirmar."})]})]}),e.requires_hil&&(0,s.jsxs)("div",{className:"flex items-start gap-3 p-4 bg-orange-500/20 border border-orange-500/30 rounded-lg",children:[(0,s.jsx)(O,{className:"w-5 h-5 text-orange-400 mt-0.5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-orange-400",children:"Projeto Nao Atribuido"}),(0,s.jsx)("p",{className:"text-xs text-orange-400/80 mt-1",children:"Esta entrada sera criada sem projeto. Voce podera atribuir um projeto depois."})]})]}),(0,s.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,s.jsxs)(l.Button,{variant:"outline",onClick:t,className:"flex-1",disabled:r,children:[(0,s.jsx)(P.X,{className:"w-4 h-4 mr-2"}),"Cancelar"]}),(0,s.jsx)(l.Button,{onClick:a,className:"flex-1 bg-gradient-to-r from-blue-mid to-green-500 hover:from-blue-mid/80 hover:to-green-500/80 text-white",disabled:r,children:r?(0,s.jsx)(s.Fragment,{children:"Confirmando..."}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(T.CheckCircle2,{className:"w-4 h-4 mr-2"}),"Confirmar Entrada"]})})]})]})})]})}var ek=e.i(71435),eE=e.i(21748);let eS=(0,q.default)("columns-2",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M12 3v18",key:"108xh3"}]]);var eA=e.i(54267),eq=e.i(7723);function eI({preview:e,onConfirm:a,onCancel:t,isConfirming:r=!1}){let{stats:n,column_mappings:o,matched_rows:c,unmatched_rows:d,confidence_score:m}=e,x=(0,Z.requiresHILReview)(e),u=e=>e>=.9?"bg-green-500/20 text-green-400":e>=.7?"bg-yellow-500/20 text-yellow-400":"bg-red-500/20 text-red-400";return(0,s.jsxs)(L.GlassCard,{children:[(0,s.jsx)(L.GlassCardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(eE.FileSpreadsheet,{className:"w-4 h-4 text-emerald-400"}),(0,s.jsx)(L.GlassCardTitle,{children:"Preview da Planilha"}),(0,s.jsx)($.Badge,{variant:"outline",className:"text-xs",children:e.file_type.toUpperCase()})]}),(0,s.jsxs)($.Badge,{className:u(m?.overall||0),children:["Match: ",Math.round(100*(n.match_rate||0)),"%"]})]})}),(0,s.jsx)(L.GlassCardContent,{children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 p-4 bg-white/5 rounded-lg",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-text-muted",children:"Total de Linhas"}),(0,s.jsx)("p",{className:"text-lg font-medium text-text-primary",children:e.total_rows})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-text-muted",children:"Linhas Encontradas"}),(0,s.jsx)("p",{className:"text-lg font-medium text-green-400",children:n.matched_count})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-text-muted",children:"Nao Encontradas"}),(0,s.jsx)("p",{className:"text-lg font-medium text-yellow-400",children:n.unmatched_count})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-text-muted",children:"Quantidade Total"}),(0,s.jsx)("p",{className:"text-lg font-medium text-text-primary",children:n.total_quantity})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h4",{className:"text-sm font-medium text-text-primary mb-3 flex items-center gap-2",children:[(0,s.jsx)(eS,{className:"w-4 h-4 text-blue-light"}),"Mapeamento de Colunas"]}),(0,s.jsx)("div",{className:"space-y-2",children:o.map((e,a)=>(0,s.jsxs)(i.motion.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.05*a},className:"flex items-center gap-3 p-2 bg-white/5 rounded-lg",children:[(0,s.jsx)("div",{className:"flex-1 min-w-0",children:(0,s.jsx)("p",{className:"text-sm text-text-primary truncate",children:e.file_column})}),(0,s.jsx)(et.ArrowRight,{className:"w-4 h-4 text-text-muted shrink-0"}),(0,s.jsx)("div",{className:"flex-1 min-w-0",children:(0,s.jsx)("p",{className:"text-sm text-blue-light truncate",children:e.target_field})}),(0,s.jsxs)($.Badge,{className:`shrink-0 ${u(e.confidence)}`,children:[Math.round(100*e.confidence),"%"]})]},a))})]}),e.unmapped_columns.length>0&&(0,s.jsxs)("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)(eq.HelpCircle,{className:"w-4 h-4 text-yellow-400"}),(0,s.jsx)("p",{className:"text-xs font-medium text-yellow-400",children:"Colunas Nao Mapeadas"})]}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:e.unmapped_columns.map((e,a)=>(0,s.jsx)($.Badge,{variant:"outline",className:"text-xs text-yellow-400 border-yellow-500/30",children:e},a))})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h4",{className:"text-sm font-medium text-text-primary mb-3 flex items-center gap-2",children:[(0,s.jsx)(Q.Table,{className:"w-4 h-4 text-emerald-400"}),"Amostra de Dados (",n.preview_rows_shown," linhas)"]}),(0,s.jsx)(ek.ScrollArea,{className:"h-48",children:(0,s.jsxs)("div",{className:"space-y-2",children:[c.slice(0,5).map((e,a)=>(0,s.jsxs)(i.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.05*a},className:"flex items-center gap-3 p-3 bg-white/5 rounded-lg",children:[(0,s.jsx)("div",{className:`w-6 h-6 rounded-full flex items-center justify-center ${e.pn_match?"bg-green-500/20":"bg-yellow-500/20"}`,children:e.pn_match?(0,s.jsx)(eA.Check,{className:"w-3 h-3 text-green-400"}):(0,s.jsx)(eq.HelpCircle,{className:"w-3 h-3 text-yellow-400"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-sm text-text-primary truncate",children:e.mapped_data?.part_number||e.mapped_data?.description||`Linha ${e.row_number}`}),(0,s.jsxs)("p",{className:"text-xs text-text-muted",children:["Qtd: ",e.mapped_data?.quantity||"-"," | Match: ",e.match_method||"-"]})]}),(0,s.jsxs)($.Badge,{className:u(e.match_confidence),children:[Math.round(100*e.match_confidence),"%"]})]},a)),d.slice(0,3).map((e,a)=>(0,s.jsxs)(i.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:(c.length+a)*.05},className:"flex items-center gap-3 p-3 bg-red-500/5 border border-red-500/20 rounded-lg",children:[(0,s.jsx)("div",{className:"w-6 h-6 rounded-full flex items-center justify-center bg-red-500/20",children:(0,s.jsx)(P.X,{className:"w-3 h-3 text-red-400"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-sm text-red-400 truncate",children:e.mapped_data?.description||`Linha ${e.row_number}`}),e.validation_errors.length>0&&(0,s.jsx)("p",{className:"text-xs text-red-400/70",children:e.validation_errors[0]})]})]},`unmatched-${a}`))]})})]}),x&&(0,s.jsxs)("div",{className:"flex items-start gap-3 p-4 bg-yellow-500/20 border border-yellow-500/30 rounded-lg",children:[(0,s.jsx)(J.AlertTriangle,{className:"w-5 h-5 text-yellow-400 mt-0.5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-yellow-400",children:"Revisao Necessaria"}),(0,s.jsx)("p",{className:"text-xs text-yellow-400/80 mt-1",children:"Algumas linhas nao foram mapeadas automaticamente. Revise os dados antes de confirmar."})]})]}),(0,s.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,s.jsxs)(l.Button,{variant:"outline",onClick:t,className:"flex-1",disabled:r,children:[(0,s.jsx)(P.X,{className:"w-4 h-4 mr-2"}),"Cancelar"]}),(0,s.jsx)(l.Button,{onClick:a,className:"flex-1 bg-gradient-to-r from-emerald-500 to-green-500 hover:from-emerald-500/80 hover:to-green-500/80 text-white",disabled:r||0===n.matched_count,children:r?(0,s.jsx)(s.Fragment,{children:"Importando..."}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(T.CheckCircle2,{className:"w-4 h-4 mr-2"}),"Importar ",n.matched_count," Itens"]})})]})]})})]})}var eP=e.i(55156);function eO({preview:e,onConfirm:a,onCancel:t,isConfirming:r=!1}){let{items:n,confidence:o,notes:c,raw_text_preview:d}=e;return(0,s.jsxs)(L.GlassCard,{children:[(0,s.jsx)(L.GlassCardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(K,{className:"w-4 h-4 text-yellow-400"}),(0,s.jsx)(L.GlassCardTitle,{children:"Interpretacao AI"}),(0,s.jsxs)($.Badge,{className:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 text-purple-400 border-none",children:[(0,s.jsx)(R.Brain,{className:"w-3 h-3 mr-1"}),"Gemini AI"]})]}),(0,s.jsxs)($.Badge,{className:"bg-yellow-500/20 text-yellow-400",children:["Confianca: ",Math.round(100*o),"%"]})]})}),(0,s.jsx)(L.GlassCardContent,{children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-start gap-3 p-4 bg-gradient-to-r from-purple-500/10 to-pink-500/10 border border-purple-500/20 rounded-lg",children:[(0,s.jsx)(W.Sparkles,{className:"w-5 h-5 text-purple-400 mt-0.5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-purple-400",children:"Processamento por Inteligencia Artificial"}),(0,s.jsxs)("p",{className:"text-xs text-purple-400/80 mt-1",children:["Os dados abaixo foram extraidos de texto nao estruturado usando Gemini AI. Revisao manual e ",(0,s.jsx)("strong",{children:"obrigatoria"})," antes de confirmar."]})]})]}),c&&(0,s.jsxs)("div",{className:"p-3 bg-white/5 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)(eP.MessageSquare,{className:"w-4 h-4 text-text-muted"}),(0,s.jsx)("p",{className:"text-xs font-medium text-text-muted",children:"Notas da AI"})]}),(0,s.jsx)("p",{className:"text-sm text-text-secondary",children:c})]}),d&&(0,s.jsxs)("div",{className:"p-3 bg-white/5 rounded-lg border border-border",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)(K,{className:"w-4 h-4 text-text-muted"}),(0,s.jsx)("p",{className:"text-xs font-medium text-text-muted",children:"Texto Original"})]}),(0,s.jsxs)("pre",{className:"text-xs text-text-muted font-mono whitespace-pre-wrap max-h-24 overflow-y-auto",children:[d.substring(0,500),d.length>500&&"..."]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h4",{className:"text-sm font-medium text-text-primary mb-3 flex items-center gap-2",children:[(0,s.jsx)(eN.Package,{className:"w-4 h-4 text-yellow-400"}),"Itens Extraidos (",n.length,")"]}),0===n.length?(0,s.jsxs)("div",{className:"text-center py-8 bg-white/5 rounded-lg",children:[(0,s.jsx)(J.AlertTriangle,{className:"w-8 h-8 text-yellow-400 mx-auto mb-2"}),(0,s.jsx)("p",{className:"text-sm text-text-muted",children:"Nenhum item identificado"}),(0,s.jsx)("p",{className:"text-xs text-text-muted mt-1",children:"A AI nao conseguiu extrair itens de inventario do texto fornecido."})]}):(0,s.jsx)(ek.ScrollArea,{className:"h-48",children:(0,s.jsx)("div",{className:"space-y-2",children:n.map((e,a)=>(0,s.jsxs)(i.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.05*a},className:"group relative p-3 bg-white/5 rounded-lg hover:bg-white/10 transition-colors",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-lg bg-yellow-500/20 flex items-center justify-center shrink-0",children:(0,s.jsx)(eN.Package,{className:"w-4 h-4 text-yellow-400"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-sm text-text-primary",children:e.description||"Sem descricao"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[e.part_number&&(0,s.jsxs)($.Badge,{variant:"outline",className:"text-xs",children:["PN: ",e.part_number]}),e.serial&&(0,s.jsxs)($.Badge,{variant:"outline",className:"text-xs",children:["SN: ",e.serial]})]})]}),(0,s.jsxs)("div",{className:"text-right shrink-0",children:[(0,s.jsxs)("p",{className:"text-sm font-medium text-text-primary",children:["Qtd: ",e.quantity," ",e.unit||"un"]}),e.confidence&&(0,s.jsxs)("p",{className:"text-xs text-text-muted",children:[Math.round(100*e.confidence),"% conf."]})]}),(0,s.jsx)(l.Button,{variant:"ghost",size:"sm",className:"opacity-0 group-hover:opacity-100 transition-opacity",children:(0,s.jsx)(I,{className:"w-3 h-3"})})]}),e.raw_text&&(0,s.jsxs)("p",{className:"text-xs text-text-muted mt-2 pl-11 truncate",children:['Fonte: "',e.raw_text,'"']})]},a))})})]}),(0,s.jsxs)("div",{className:"flex items-start gap-3 p-4 bg-orange-500/20 border border-orange-500/30 rounded-lg",children:[(0,s.jsx)(J.AlertTriangle,{className:"w-5 h-5 text-orange-400 mt-0.5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-orange-400",children:"Revisao Obrigatoria"}),(0,s.jsx)("p",{className:"text-xs text-orange-400/80 mt-1",children:"Importacoes de texto sempre requerem revisao humana. Verifique cada item antes de confirmar para garantir a precisao dos dados."})]})]}),(0,s.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,s.jsxs)(l.Button,{variant:"outline",onClick:t,className:"flex-1",disabled:r,children:[(0,s.jsx)(P.X,{className:"w-4 h-4 mr-2"}),"Cancelar"]}),(0,s.jsx)(l.Button,{onClick:a,className:"flex-1 bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-500/80 hover:to-orange-500/80 text-white",disabled:r||0===n.length,children:r?(0,s.jsx)(s.Fragment,{children:"Processando..."}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(T.CheckCircle2,{className:"w-4 h-4 mr-2"}),"Revisar e Confirmar"]})})]})]})})]})}var eT=e.i(67013),eB=e.i(62318),eF=e.i(48681),eR=e.i(11152),eM=e.i(79278);let eG={success:!0,confidence:{overall:75,factors:[{id:"data_completeness",label:"Completude dos dados",score:75,weight:.3},{id:"format_consistency",label:"Consistência do formato",score:80,weight:.3},{id:"value_validation",label:"Validação de valores",score:70,weight:.4}],risk_level:"low"},observations:{patterns:[],suggestions:[],warnings:[]},ai_commentary:"Dados analisados com sucesso. Aguardando confirmação para prosseguir.",learn_from:{category:"import_general",insights:[]},generated_at:new Date().toISOString()};function eX({open:e,onOpenChange:t,preview:n,onConfirm:o,isConfirming:c=!1}){var d,m;let[x,u]=(0,a.useState)(null),[p,h]=(0,a.useState)(!1),[g,j]=(0,a.useState)(null);(0,a.useEffect)(()=>{!e||x||p||f()},[e]);let f=(0,a.useCallback)(async()=>{h(!0),j(null);try{let e=await (0,D.generateImportObservations)(n);e.data.success?u(e.data):u(eG)}catch(e){console.error("[SmartImportConfirmationModal] Failed to fetch observations:",e),j("Nao foi possivel carregar observacoes do NEXO"),u(eG)}finally{h(!1)}},[n]),b=async()=>{await o(),t(!1)},v=()=>{c||t(!1)},N="items"in n&&Array.isArray(n.items)?n.items.length:0,y="total_value"in n?n.total_value:void 0,w="supplier"in n&&"object"==typeof n.supplier&&null!==n.supplier&&n.supplier.name||"Nao informado",_=(d=n.source_type).startsWith("nf_")?V.FileText:"spreadsheet"===d?eN.Package:V.FileText;return(0,s.jsx)(eT.Root,{open:e,onOpenChange:v,children:(0,s.jsx)(r.AnimatePresence,{children:e&&(0,s.jsxs)(eT.Portal,{forceMount:!0,children:[(0,s.jsx)(eT.Overlay,{asChild:!0,children:(0,s.jsx)(i.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 z-50 bg-[#151720]/85 backdrop-blur-[24px]"})}),(0,s.jsx)(eT.Content,{asChild:!0,children:(0,s.jsxs)(i.motion.div,{initial:{opacity:0,scale:.95,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:10},transition:{duration:.2,ease:"easeOut"},className:(0,C.cn)("fixed left-1/2 top-1/2 z-50 w-full max-w-[540px] -translate-x-1/2 -translate-y-1/2","bg-[#1a1d28]/90 backdrop-blur-xl","border border-white/[0.06] rounded-2xl shadow-2xl","p-6 max-h-[90vh] overflow-y-auto"),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsxs)(eT.Title,{className:"text-xl font-semibold text-white flex items-center gap-3",children:[(0,s.jsx)("div",{className:"p-2 rounded-xl bg-gradient-to-br from-[#960A9C]/20 to-[#2226C0]/20 border border-white/[0.04]",children:(0,s.jsx)(eA.Check,{className:"w-5 h-5 text-[#00FAFB]"})}),"Confirmar Importacao"]}),(0,s.jsx)(eT.Close,{asChild:!0,children:(0,s.jsx)("button",{className:"p-2 rounded-lg hover:bg-white/5 transition-colors disabled:opacity-50",disabled:c,"aria-label":"Fechar",children:(0,s.jsx)(P.X,{className:"w-5 h-5 text-gray-400"})})})]}),(0,s.jsxs)("div",{className:"mb-6 p-4 rounded-xl bg-white/[0.02] border border-white/[0.04]",children:[(0,s.jsxs)("h3",{className:"text-sm font-medium text-gray-400 mb-3 flex items-center gap-2",children:[(0,s.jsx)(eN.Package,{className:"w-4 h-4"}),"Resumo da Importacao"]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Fonte"}),(0,s.jsxs)("p",{className:"text-sm text-white flex items-center gap-2",children:[(0,s.jsx)(_,{className:"w-4 h-4 text-[#00FAFB]"}),{nf_xml:"NF XML",nf_pdf:"NF PDF",nf_image:"Imagem NF",spreadsheet:"Planilha",text:"Texto/Manual",sap_export:"Export SAP"}[m=n.source_type]||m]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Itens"}),(0,s.jsxs)("p",{className:"text-sm text-white font-medium",children:[N," ativo(s)"]})]}),void 0!==y&&(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Valor Total"}),(0,s.jsxs)("p",{className:"text-sm text-white font-medium",children:["R$ ",y.toLocaleString("pt-BR",{minimumFractionDigits:2})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Fornecedor"}),(0,s.jsx)("p",{className:"text-sm text-white truncate",children:w})]})]})]}),(0,s.jsxs)("div",{className:"mb-6 p-4 rounded-xl bg-gradient-to-r from-[#960A9C]/10 to-[#2226C0]/10 border border-white/[0.04]",children:[(0,s.jsxs)("h3",{className:"text-sm font-medium text-gray-400 mb-3 flex items-center gap-2",children:[(0,s.jsx)(eB.Bot,{className:"w-4 h-4 text-[#A855F7]"}),"Observacoes do NEXO"]}),p?(0,s.jsxs)("div",{className:"flex items-center gap-3 py-4",children:[(0,s.jsx)(eM.Loader2,{className:"w-5 h-5 text-[#A855F7] animate-spin"}),(0,s.jsx)("p",{className:"text-sm text-gray-400",children:"Analisando dados..."})]}):x?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(eR.Shield,{className:"w-4 h-4 text-gray-400"}),(0,s.jsx)("span",{className:"text-sm text-gray-400",children:"Confianca"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-24 h-2 bg-white/10 rounded-full overflow-hidden",children:(0,s.jsx)(i.motion.div,{initial:{width:0},animate:{width:`${x.confidence.overall}%`},transition:{duration:.5,delay:.2},className:(0,C.cn)("h-full rounded-full",x.confidence.overall>=75?"bg-[#00FAFB]":x.confidence.overall>=50?"bg-amber-400":"bg-[#FD5665]")})}),(0,s.jsxs)("span",{className:"text-sm font-medium text-white",children:[x.confidence.overall,"%"]}),(0,s.jsxs)("span",{className:(0,C.cn)("text-xs",function(e){switch(e){case"low":return"text-[#00FAFB]";case"medium":return"text-amber-400";case"high":return"text-[#FD5665]";default:return"text-gray-400"}}(x.confidence.risk_level)),children:["(",function(e){switch(e){case"low":return"Baixo";case"medium":return"Médio";case"high":return"Alto";default:return"Desconhecido"}}(x.confidence.risk_level),")"]})]})]}),(0,s.jsx)("div",{className:"p-3 rounded-lg bg-white/[0.02] border border-white/[0.02]",children:(0,s.jsx)("p",{className:"text-sm text-gray-300 leading-relaxed",children:x.ai_commentary})}),(x.observations.patterns.length>0||x.observations.suggestions.length>0)&&(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[x.observations.patterns.length>0&&(0,s.jsxs)("div",{className:"p-3 rounded-lg bg-white/[0.02]",children:[(0,s.jsxs)("p",{className:"text-xs text-gray-500 mb-2 flex items-center gap-1",children:[(0,s.jsx)(eF.TrendingUp,{className:"w-3 h-3"}),"Padroes Detectados"]}),(0,s.jsx)("ul",{className:"space-y-1",children:x.observations.patterns.slice(0,3).map((e,a)=>(0,s.jsx)("li",{className:"text-xs text-gray-400 truncate",children:e},a))})]}),x.observations.suggestions.length>0&&(0,s.jsxs)("div",{className:"p-3 rounded-lg bg-white/[0.02]",children:[(0,s.jsxs)("p",{className:"text-xs text-gray-500 mb-2 flex items-center gap-1",children:[(0,s.jsx)(ei.Lightbulb,{className:"w-3 h-3"}),"Sugestoes"]}),(0,s.jsx)("ul",{className:"space-y-1",children:x.observations.suggestions.slice(0,3).map((e,a)=>(0,s.jsx)("li",{className:"text-xs text-gray-400 truncate",children:e},a))})]})]}),x.observations.warnings.length>0&&(0,s.jsxs)("div",{className:"p-3 rounded-lg bg-amber-500/10 border border-amber-500/20",children:[(0,s.jsxs)("p",{className:"text-xs text-amber-400 mb-2 flex items-center gap-1",children:[(0,s.jsx)(J.AlertTriangle,{className:"w-3 h-3"}),"Alertas"]}),(0,s.jsx)("ul",{className:"space-y-1",children:x.observations.warnings.map((e,a)=>(0,s.jsx)("li",{className:"text-xs text-amber-300",children:e},a))})]})]}):g?(0,s.jsxs)("div",{className:"flex items-center gap-3 py-4 text-amber-400",children:[(0,s.jsx)(J.AlertTriangle,{className:"w-5 h-5"}),(0,s.jsx)("p",{className:"text-sm",children:g})]}):null]}),(0,s.jsxs)("div",{className:"flex items-center justify-end gap-3",children:[(0,s.jsx)(l.Button,{variant:"outline",onClick:v,disabled:c,className:"bg-transparent border-white/10 text-gray-400 hover:bg-white/5 hover:text-white",children:"Cancelar"}),(0,s.jsx)(l.Button,{onClick:b,disabled:c||p,className:(0,C.cn)("bg-gradient-to-r from-[#00FAFB] to-[#2226C0]","text-white font-medium","hover:opacity-90 transition-opacity","disabled:opacity-50"),children:c?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eM.Loader2,{className:"w-4 h-4 mr-2 animate-spin"}),"Confirmando..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eA.Check,{className:"w-4 h-4 mr-2"}),"Confirmar Importacao"]})})]})]})})]})})})}var eD=e.i(47636);function eL({preview:e,onConfirm:t,onCancel:r}){let[i,n]=(0,a.useState)(!1),[l,o]=(0,a.useState)(!1),c=async()=>{n(!0)},d=async()=>{o(!0);try{await t()}finally{o(!1)}};return(0,s.jsxs)(s.Fragment,{children:[!e.success&&"error"in e?(0,s.jsx)(ez,{error:e.error||e.message||"Erro desconhecido",fileType:e.detected_file_type,filename:e.filename,onCancel:r}):(0,Z.isNFImportResult)(e)?(0,s.jsx)(eC,{preview:e,onConfirm:c,onCancel:r,isConfirming:l}):(0,Z.isSpreadsheetImportResult)(e)?(0,s.jsx)(eI,{preview:e,onConfirm:c,onCancel:r,isConfirming:l}):(0,Z.isTextImportResult)(e)?(0,s.jsx)(eO,{preview:e,onConfirm:c,onCancel:r,isConfirming:l}):(0,s.jsx)(e$,{sourceType:e.source_type,onCancel:r}),(0,s.jsx)(eX,{open:i,onOpenChange:n,preview:e,onConfirm:d,isConfirming:l})]})}function e$({sourceType:e,onCancel:a}){return(0,s.jsxs)(L.GlassCard,{children:[(0,s.jsx)(L.GlassCardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(eD.FileQuestion,{className:"w-4 h-4 text-yellow-400"}),(0,s.jsx)(L.GlassCardTitle,{children:"Preview Nao Disponivel"})]})}),(0,s.jsx)(L.GlassCardContent,{children:(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)(J.AlertTriangle,{className:"w-12 h-12 text-yellow-400 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-sm text-text-primary mb-2",children:"Tipo de preview desconhecido"}),(0,s.jsxs)("p",{className:"text-xs text-text-muted mb-6",children:['O tipo de fonte "',e,'" nao possui um preview implementado.']}),(0,s.jsx)(l.Button,{variant:"outline",onClick:a,children:"Voltar"})]})})]})}function ez({error:e,fileType:a,filename:t,onCancel:r}){let i=a?(0,Z.getFileTypeLabel)(a):"Arquivo";return(0,s.jsxs)(L.GlassCard,{children:[(0,s.jsx)(L.GlassCardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(ec.XCircle,{className:"w-4 h-4 text-red-400"}),(0,s.jsx)(L.GlassCardTitle,{children:"Erro ao Processar Arquivo"})]})}),(0,s.jsx)(L.GlassCardContent,{children:(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)(ec.XCircle,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),t&&(0,s.jsx)("p",{className:"text-sm text-text-primary mb-2 font-medium",children:t}),(0,s.jsx)("p",{className:"text-xs text-text-muted mb-4",children:i}),(0,s.jsx)("div",{className:"bg-red-500/10 border border-red-500/30 rounded-lg p-4 mb-6 max-w-md mx-auto",children:(0,s.jsx)("p",{className:"text-sm text-red-400",children:e})}),(0,s.jsx)("p",{className:"text-xs text-text-muted mb-6",children:"Por favor, tente novamente ou entre em contato com o suporte."}),(0,s.jsx)(l.Button,{variant:"outline",onClick:r,children:"Voltar"})]})})]})}var eU=e.i(23750),eV=e.i(43293),eH=e.i(14136),eQ=e.i(51946),eK=e.i(13862);function eJ({isProcessing:e,error:t,projects:r,locations:i,partNumbers:n,onSubmit:o,onClear:c}){let[d,m]=(0,a.useState)(""),[x,u]=(0,a.useState)(""),[p,h]=(0,a.useState)(""),[g,j]=(0,a.useState)(""),[f,b]=(0,a.useState)([{id:crypto.randomUUID(),part_number_id:"",part_number_code:"",quantity:1,serial_numbers:"",unit_value:0,notes:""}]),v=(0,a.useCallback)(()=>{b(e=>[...e,{id:crypto.randomUUID(),part_number_id:"",part_number_code:"",quantity:1,serial_numbers:"",unit_value:0,notes:""}])},[]),N=(0,a.useCallback)(e=>{b(s=>s.filter(s=>s.id!==e))},[]),y=(0,a.useCallback)((e,s,a)=>{b(t=>t.map(t=>{if(t.id!==e)return t;if("part_number_id"===s){let e=n.find(e=>e.id===a);return{...t,part_number_id:a,part_number_code:e?.part_number||""}}return{...t,[s]:a}}))},[n]),w=async()=>{if(!x||0===f.length)return;let e=f.filter(e=>e.part_number_id&&e.quantity>0);if(0!==e.length)try{await o({items:e,project_id:d||void 0,destination_location_id:x,document_reference:p||void 0,notes:g||void 0}),b([{id:crypto.randomUUID(),part_number_id:"",part_number_code:"",quantity:1,serial_numbers:"",unit_value:0,notes:""}]),m(""),u(""),h(""),j("")}catch{}},_=f.filter(e=>e.part_number_id).length,C=f.reduce((e,s)=>e+(s.quantity||0),0);return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-start gap-3 p-4 bg-purple-500/10 border border-purple-500/20 rounded-lg",children:[(0,s.jsx)(I,{className:"w-5 h-5 text-purple-400 mt-0.5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-purple-400",children:"Entrada Manual de Materiais"}),(0,s.jsx)("p",{className:"text-xs text-purple-400/80 mt-1",children:"Registre entradas sem arquivo de origem. Ideal para recebimentos avulsos, doacoes ou ajustes de estoque."})]})]}),(0,s.jsxs)(L.GlassCard,{children:[(0,s.jsx)(L.GlassCardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(V.FileText,{className:"w-4 h-4 text-purple-400"}),(0,s.jsx)(L.GlassCardTitle,{children:"Informacoes da Entrada"})]})}),(0,s.jsx)(L.GlassCardContent,{children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"text-sm font-medium text-text-primary mb-2 block",children:[(0,s.jsx)(F.Briefcase,{className:"w-4 h-4 inline mr-2"}),"Projeto ",(0,s.jsx)("span",{className:"text-text-muted font-normal",children:"(opcional)"})]}),(0,s.jsxs)("select",{className:"w-full px-3 py-2 bg-white/5 border border-border rounded-md text-sm text-text-primary",value:d,onChange:e=>m(e.target.value),children:[(0,s.jsx)("option",{value:"",children:"Sem projeto (atribuir depois)..."}),r.filter(e=>e.is_active).map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.code," - ",e.name]},e.id))]}),!d&&(0,s.jsxs)("p",{className:"text-xs text-orange-400 mt-1",children:[(0,s.jsx)(eK.Clock,{className:"w-3 h-3 inline mr-1"}),"Entrada ficara aguardando atribuicao de projeto"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"text-sm font-medium text-text-primary mb-2 block",children:[(0,s.jsx)(eQ.MapPin,{className:"w-4 h-4 inline mr-2"}),"Local de Destino ",(0,s.jsx)("span",{className:"text-red-400",children:"*"})]}),(0,s.jsxs)("select",{className:"w-full px-3 py-2 bg-white/5 border border-border rounded-md text-sm text-text-primary",value:x,onChange:e=>u(e.target.value),children:[(0,s.jsx)("option",{value:"",children:"Selecione o local..."}),i.filter(e=>e.is_active).map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.code," - ",e.name]},e.id))]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"text-sm font-medium text-text-primary mb-2 block",children:[(0,s.jsx)(e_.Hash,{className:"w-4 h-4 inline mr-2"}),"Referencia/Documento ",(0,s.jsx)("span",{className:"text-text-muted font-normal",children:"(opcional)"})]}),(0,s.jsx)(eU.Input,{placeholder:"Ex: NF 12345, Remessa 001...",value:p,onChange:e=>h(e.target.value),className:"bg-white/5 border-border"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"text-sm font-medium text-text-primary mb-2 block",children:["Observacoes Gerais ",(0,s.jsx)("span",{className:"text-text-muted font-normal",children:"(opcional)"})]}),(0,s.jsx)(eU.Input,{placeholder:"Observacoes da entrada...",value:g,onChange:e=>j(e.target.value),className:"bg-white/5 border-border"})]})]})]})})]}),(0,s.jsxs)(L.GlassCard,{children:[(0,s.jsx)(L.GlassCardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(eN.Package,{className:"w-4 h-4 text-purple-400"}),(0,s.jsx)(L.GlassCardTitle,{children:"Itens da Entrada"}),(0,s.jsxs)($.Badge,{variant:"outline",children:[_," itens"]})]}),(0,s.jsxs)(l.Button,{size:"sm",variant:"outline",onClick:v,children:[(0,s.jsx)(eV.Plus,{className:"w-4 h-4 mr-1"}),"Adicionar Item"]})]})}),(0,s.jsx)(L.GlassCardContent,{children:(0,s.jsx)("div",{className:"space-y-4",children:f.map((e,a)=>(0,s.jsxs)("div",{className:"p-4 bg-white/5 rounded-lg border border-border/50",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("span",{className:"text-sm font-medium text-text-muted",children:["Item #",a+1]}),f.length>1&&(0,s.jsx)(l.Button,{size:"sm",variant:"ghost",className:"text-red-400 hover:text-red-300 hover:bg-red-500/10",onClick:()=>N(e.id),children:(0,s.jsx)(eH.Trash2,{className:"w-4 h-4"})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsxs)("label",{className:"text-xs text-text-muted mb-1 block",children:["Part Number ",(0,s.jsx)("span",{className:"text-red-400",children:"*"})]}),(0,s.jsxs)("select",{className:"w-full px-3 py-2 bg-white/5 border border-border rounded-md text-sm text-text-primary",value:e.part_number_id,onChange:s=>y(e.id,"part_number_id",s.target.value),children:[(0,s.jsx)("option",{value:"",children:"Selecione o PN..."}),n.filter(e=>e.is_active).map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.part_number," - ",e.description]},e.id))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"text-xs text-text-muted mb-1 block",children:["Quantidade ",(0,s.jsx)("span",{className:"text-red-400",children:"*"})]}),(0,s.jsx)(eU.Input,{type:"number",min:"1",value:e.quantity,onChange:s=>y(e.id,"quantity",parseInt(s.target.value)||1),className:"bg-white/5 border-border"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-text-muted mb-1 block",children:"Valor Unit. (R$)"}),(0,s.jsx)(eU.Input,{type:"number",min:"0",step:"0.01",value:e.unit_value,onChange:s=>y(e.id,"unit_value",parseFloat(s.target.value)||0),className:"bg-white/5 border-border"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-text-muted mb-1 block",children:"Numeros de Serie (separados por virgula)"}),(0,s.jsx)(eU.Input,{placeholder:"SN001, SN002, SN003...",value:e.serial_numbers,onChange:s=>y(e.id,"serial_numbers",s.target.value),className:"bg-white/5 border-border"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-text-muted mb-1 block",children:"Observacoes do Item"}),(0,s.jsx)(eU.Input,{placeholder:"Notas sobre este item...",value:e.notes,onChange:s=>y(e.id,"notes",s.target.value),className:"bg-white/5 border-border"})]})]})]},e.id))})})]}),(0,s.jsx)("div",{className:"flex items-center justify-between p-4 bg-white/5 rounded-lg border border-border",children:(0,s.jsxs)("div",{className:"flex items-center gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-text-muted",children:"Total de Itens"}),(0,s.jsx)("p",{className:"text-lg font-semibold text-text-primary",children:_})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-text-muted",children:"Quantidade Total"}),(0,s.jsx)("p",{className:"text-lg font-semibold text-text-primary",children:C})]})]})}),t&&(0,s.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-red-500/20 border border-red-500/30 rounded-lg",children:[(0,s.jsx)(J.AlertTriangle,{className:"w-5 h-5 text-red-400"}),(0,s.jsx)("p",{className:"text-sm text-red-400",children:t})]}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)(l.Button,{variant:"outline",onClick:c,className:"flex-1",children:"Limpar"}),(0,s.jsx)(l.Button,{onClick:w,className:"flex-1 bg-gradient-to-r from-purple-600 to-purple-500",disabled:!x||0===_||e,children:e?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(B.RefreshCw,{className:"w-4 h-4 mr-2 animate-spin"}),"Registrando..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(T.CheckCircle2,{className:"w-4 h-4 mr-2"}),"Registrar Entrada (",_," itens)"]})})]})]})}function eW({entries:e,isLoading:a,onAssignProject:t,onReview:r}){return 0===e.length?null:(0,s.jsxs)(L.GlassCard,{children:[(0,s.jsx)(L.GlassCardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(J.AlertTriangle,{className:"w-4 h-4 text-yellow-400"}),(0,s.jsx)(L.GlassCardTitle,{children:"Entradas Pendentes"}),(0,s.jsx)($.Badge,{variant:"destructive",children:e.length})]})}),(0,s.jsx)(L.GlassCardContent,{children:a?(0,s.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,s.jsx)(B.RefreshCw,{className:"w-6 h-6 text-text-muted animate-spin"})}):(0,s.jsx)("div",{className:"space-y-2",children:e.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg hover:bg-white/10 transition-colors",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsxs)("p",{className:"text-sm font-medium text-text-primary",children:["NF ",e.nf_number]}),function(e){switch(e){case"PENDING_PROJECT":return(0,s.jsx)($.Badge,{className:"bg-orange-500/20 text-orange-400",children:"Aguardando Projeto"});case"PENDING_APPROVAL":return(0,s.jsx)($.Badge,{className:"bg-yellow-500/20 text-yellow-400",children:"Aguardando Aprovacao"});case"PENDING_CONFIRMATION":case"PENDING":return(0,s.jsx)($.Badge,{className:"bg-blue-500/20 text-blue-400",children:"Aguardando Confirmacao"});case"PROCESSING":return(0,s.jsx)($.Badge,{className:"bg-purple-500/20 text-purple-400",children:"Processando"});case"CONFIRMED":case"COMPLETED":return(0,s.jsx)($.Badge,{className:"bg-green-500/20 text-green-400",children:"Confirmado"});case"REJECTED":case"CANCELLED":return(0,s.jsx)($.Badge,{className:"bg-red-500/20 text-red-400",children:"Cancelado"});default:return(0,s.jsx)($.Badge,{className:"bg-gray-500/20 text-gray-400",children:e})}}(e.status)]}),(0,s.jsxs)("p",{className:"text-xs text-text-muted",children:[e.total_items," itens - ",e.supplier_name," -"," ",new Date(e.uploaded_at).toLocaleDateString("pt-BR")]}),e.project_name&&(0,s.jsxs)("p",{className:"text-xs text-text-muted mt-0.5",children:[(0,s.jsx)(F.Briefcase,{className:"w-3 h-3 inline mr-1"}),e.project_name]})]}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:"PENDING_PROJECT"===e.status?(0,s.jsxs)(l.Button,{size:"sm",className:"bg-orange-500/20 hover:bg-orange-500/30 text-orange-400",onClick:()=>t(e.id),children:[(0,s.jsx)(O,{className:"w-4 h-4 mr-1"}),"Atribuir Projeto"]}):(0,s.jsx)(l.Button,{size:"sm",onClick:()=>r(e.id),children:"Revisar"})})]},e.id))})})]})}var eZ=e.i(48162),eY=e.i(83052),e0=e.i(24392);e.i(39656),e.i(8923),e.i(83671);var e2=e.i(8317);eN.Package,eQ.MapPin,eZ.RotateCcw,eY.CheckSquare,J.AlertTriangle,e0.Activity,V.FileText,el.BookOpen,eN.Package,e_.Hash,eQ.MapPin,eK.Clock;var e1=e.i(23145);let e4=(0,q.default)("message-circle-question-mark",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),e5=(0,q.default)("columns-3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);var e3=e.i(14346),e8=e.i(86094);function e6({ref:e,className:a,value:t=0,max:r=100,...i}){let n=Math.min(Math.max(t/r*100,0),100);return(0,s.jsx)("div",{ref:e,className:(0,C.cn)("relative h-2 w-full overflow-hidden rounded-full bg-white/10",a),...i,children:(0,s.jsx)("div",{className:"h-full bg-gradient-to-r from-magenta-mid to-blue-mid transition-all duration-300 ease-out",style:{width:`${n}%`}})})}var e7=e.i(71428),e9=e.i(40226),se=e.i(70460),ss=e.i(53747),sa="Radio",[st,sr]=(0,d.createContextScope)(sa),[si,sn]=st(sa),sl=a.forwardRef((e,t)=>{let{__scopeRadio:r,name:i,checked:n=!1,required:l,disabled:d,value:m="on",onCheck:x,form:u,...h}=e,[g,j]=a.useState(null),f=(0,c.useComposedRefs)(t,e=>j(e)),b=a.useRef(!1),v=!g||u||!!g.closest("form");return(0,s.jsxs)(si,{scope:r,checked:n,disabled:d,children:[(0,s.jsx)(p.Primitive.button,{type:"button",role:"radio","aria-checked":n,"data-state":sm(n),"data-disabled":d?"":void 0,disabled:d,value:m,...h,ref:f,onClick:(0,o.composeEventHandlers)(e.onClick,e=>{n||x?.(),v&&(b.current=e.isPropagationStopped(),b.current||e.stopPropagation())})}),v&&(0,s.jsx)(sd,{control:g,bubbles:!b.current,name:i,value:m,checked:n,required:l,disabled:d,form:u,style:{transform:"translateX(-100%)"}})]})});sl.displayName=sa;var so="RadioIndicator",sc=a.forwardRef((e,a)=>{let{__scopeRadio:t,forceMount:r,...i}=e,n=sn(so,t);return(0,s.jsx)(ss.Presence,{present:r||n.checked,children:(0,s.jsx)(p.Primitive.span,{"data-state":sm(n.checked),"data-disabled":n.disabled?"":void 0,...i,ref:a})})});sc.displayName=so;var sd=a.forwardRef(({__scopeRadio:e,control:t,checked:r,bubbles:i=!0,...n},l)=>{let o=a.useRef(null),d=(0,c.useComposedRefs)(o,l),m=x(r),h=(0,u.useSize)(t);return a.useEffect(()=>{let e=o.current;if(!e)return;let s=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(m!==r&&s){let a=new Event("click",{bubbles:i});s.call(e,r),e.dispatchEvent(a)}},[m,r,i]),(0,s.jsx)(p.Primitive.input,{type:"radio","aria-hidden":!0,defaultChecked:r,...n,tabIndex:-1,ref:d,style:{...n.style,...h,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function sm(e){return e?"checked":"unchecked"}sd.displayName="RadioBubbleInput";var sx=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],su="RadioGroup",[sp,sh]=(0,d.createContextScope)(su,[e9.createRovingFocusGroupScope,sr]),sg=(0,e9.createRovingFocusGroupScope)(),sj=sr(),[sf,sb]=sp(su),sv=a.forwardRef((e,a)=>{let{__scopeRadioGroup:t,name:r,defaultValue:i,value:n,required:l=!1,disabled:o=!1,orientation:c,dir:d,loop:x=!0,onValueChange:u,...h}=e,g=sg(t),j=(0,se.useDirection)(d),[f,b]=(0,m.useControllableState)({prop:n,defaultProp:i??null,onChange:u,caller:su});return(0,s.jsx)(sf,{scope:t,name:r,required:l,disabled:o,value:f,onValueChange:b,children:(0,s.jsx)(e9.Root,{asChild:!0,...g,orientation:c,dir:j,loop:x,children:(0,s.jsx)(p.Primitive.div,{role:"radiogroup","aria-required":l,"aria-orientation":c,"data-disabled":o?"":void 0,dir:j,...h,ref:a})})})});sv.displayName=su;var sN="RadioGroupItem",sy=a.forwardRef((e,t)=>{let{__scopeRadioGroup:r,disabled:i,...n}=e,l=sb(sN,r),d=l.disabled||i,m=sg(r),x=sj(r),u=a.useRef(null),p=(0,c.useComposedRefs)(t,u),h=l.value===n.value,g=a.useRef(!1);return a.useEffect(()=>{let e=e=>{sx.includes(e.key)&&(g.current=!0)},s=()=>g.current=!1;return document.addEventListener("keydown",e),document.addEventListener("keyup",s),()=>{document.removeEventListener("keydown",e),document.removeEventListener("keyup",s)}},[]),(0,s.jsx)(e9.Item,{asChild:!0,...m,focusable:!d,active:h,children:(0,s.jsx)(sl,{disabled:d,required:l.required,checked:h,...x,...n,name:l.name,ref:p,onCheck:()=>l.onValueChange(n.value),onKeyDown:(0,o.composeEventHandlers)(e=>{"Enter"===e.key&&e.preventDefault()}),onFocus:(0,o.composeEventHandlers)(n.onFocus,()=>{g.current&&u.current?.click()})})})});sy.displayName=sN;var sw=a.forwardRef((e,a)=>{let{__scopeRadioGroup:t,...r}=e,i=sj(t);return(0,s.jsx)(sc,{...i,...r,ref:a})});sw.displayName="RadioGroupIndicator";var s_=e.i(68866),s_=s_;function sC({className:e,...a}){return(0,s.jsx)(sv,{"data-slot":"radio-group",className:(0,C.cn)("grid gap-3",e),...a})}function sk({className:e,...a}){return(0,s.jsx)(sy,{"data-slot":"radio-group-item",className:(0,C.cn)("border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",e),...a,children:(0,s.jsx)(sw,{"data-slot":"radio-group-indicator",className:"relative flex items-center justify-center",children:(0,s.jsx)(s_.default,{className:"fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2"})})})}var sE=e.i(62224),sS=e.i(19249);let sA=["NEXO refinando mapeamentos...","Validando contra schema PostgreSQL...","Aplicando suas respostas...","Reavaliando confiança...","Verificando colunas obrigatórias...","Consultando padrões aprendidos...","Analisando consistência dos dados...","Confirmando tipos de dados..."],sq=e=>"string"==typeof e?e:"object"==typeof e&&null!==e&&"message"in e?e.message:String(e),sI={stage:"idle",progress:{stage:"idle",percent:0,message:""},analysis:null,sessionState:null,questions:[],answers:{},processingConfig:null,priorKnowledge:null,adaptiveThreshold:.75,reviewSummary:null,userFeedback:null,error:null,debugAnalysis:null};var sP=e.i(74117),sO=e.i(53599);let sT={info:{gradient:"from-faiston-blue-dark/20 to-faiston-blue-light/20",border:"border-faiston-blue-light/30",ring:"ring-faiston-blue-light/50"},tip:{gradient:"from-faiston-magenta-dark/20 to-faiston-magenta-light/20",border:"border-faiston-magenta-light/30",ring:"ring-faiston-magenta-light/50"},warning:{gradient:"from-amber-500/20 to-orange-500/20",border:"border-amber-400/30",ring:"ring-amber-400/50"},success:{gradient:"from-emerald-500/20 to-teal-500/20",border:"border-emerald-400/30",ring:"ring-emerald-400/50"}};function sB({ref:e,summary:t,details:n,action:l,variant:o="info",compact:c=!1,className:d,defaultExpanded:m=!1}){let[x,u]=(0,a.useState)(m),p=sT[o],h=!!(n||l),g=c?20:24;return(0,s.jsxs)(i.motion.div,{ref:e,initial:{opacity:0,y:5},animate:{opacity:1,y:0},transition:{duration:.2,ease:"easeOut"},className:(0,C.cn)("relative overflow-hidden rounded-lg","bg-gradient-to-r",p.gradient,"backdrop-blur-sm","border",p.border,c?"p-2.5":"p-3","transition-all duration-200",d),children:[(0,s.jsxs)("div",{className:(0,C.cn)("flex items-start gap-2.5",h&&"cursor-pointer select-none"),onClick:()=>h&&u(!x),onKeyDown:e=>{h&&("Enter"===e.key||" "===e.key)&&(e.preventDefault(),u(!x))},tabIndex:h?0:void 0,role:h?"button":void 0,"aria-expanded":h?x:void 0,children:[(0,s.jsx)("div",{className:(0,C.cn)("flex-shrink-0 rounded-full overflow-hidden ring-2",p.ring),style:{width:g,height:g},children:(0,s.jsx)(sO.default,{src:"/Avatars/nexo-avatar.png",alt:"NEXO",width:g,height:g,className:"object-cover"})}),(0,s.jsx)("div",{className:"flex-1 min-w-0",children:(0,s.jsx)("div",{className:(0,C.cn)("text-text-primary/90",c?"text-xs":"text-sm"),children:t})}),h&&(0,s.jsx)(i.motion.div,{animate:{rotate:180*!!x},transition:{duration:.2},className:"flex-shrink-0 mt-0.5",children:(0,s.jsx)(Y.ChevronDown,{className:(0,C.cn)("text-text-muted",c?"w-3.5 h-3.5":"w-4 h-4")})})]}),(0,s.jsx)(r.AnimatePresence,{initial:!1,children:x&&h&&(0,s.jsx)(i.motion.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2,ease:"easeInOut"},className:"overflow-hidden",children:(0,s.jsxs)("div",{className:(0,C.cn)("pt-2 mt-2 border-t border-white/5",c?"pl-7":"pl-8"),children:[n&&(0,s.jsx)("p",{className:(0,C.cn)("text-text-secondary whitespace-pre-line",c?"text-xs":"text-sm"),children:n}),l&&(0,s.jsxs)("div",{className:(0,C.cn)("mt-2 flex items-center gap-1.5","text-faiston-magenta-light font-medium",c?"text-xs":"text-sm"),children:[(0,s.jsx)("span",{"aria-hidden":!0,children:"→"}),(0,s.jsx)("span",{children:l})]})]})})})]})}let sF={summary:"Aqui mostro meu raciocínio passo a passo. Se algo parecer errado, me corrija nas perguntas abaixo!",details:`Uso o padr\xe3o ReAct para ser transparente com voc\xea:

• Pensamento (roxo): O que estou analisando
• A\xe7\xe3o (ciano): Ferramenta que estou usando
• Observa\xe7\xe3o (verde): O que encontrei

Se meu racioc\xednio parece errado em algum ponto, use as perguntas abaixo para me corrigir.`,action:"Acompanhe meu raciocínio - me corrija se necessário!"},sR=()=>`O que cada tipo de aba significa:

• Itens (ciano): Cont\xe9m os materiais/produtos → \xc9 A MAIS IMPORTANTE!
• Seriais (roxo): N\xfameros de s\xe9rie de cada item
• Metadados (amarelo): Dados do fornecedor/projeto
• Resumo (verde): Totais e estat\xedsticas (geralmente ignoro)

⚠️ Se eu errar a aba principal, vou processar os dados errados!`,sM=e=>{if((Number(e.sheetCount)||0)>1)return"Confira se a aba marcada como 'Itens' é realmente a principal!"},sG=()=>`O que os n\xedveis de confian\xe7a significam:

🟢 Alta (80%+): Tenho quase certeza - n\xe3o precisa verificar
🟡 M\xe9dia (50-79%): Provavelmente correto - vale uma olhada
🔴 Baixa (<50%): N\xe3o tenho certeza - VOC\xca precisa confirmar!

⚠️ IMPORTANTE: Se eu mapear errado, os dados v\xe3o para o campo errado no sistema!
Exemplo: Se "EQUIPAMENTO" virar "quantidade" em vez de "part_number", voc\xea n\xe3o vai encontrar os itens depois.`,sX=e=>{let s=Number(e.low)||0;return s>0?`Responda as ${s} perguntas abaixo para corrigir meus mapeamentos!`:"Tudo certo! Pode confirmar a importação."},sD={summary:"🚨 Preciso da sua ajuda aqui! Não consegui descobrir essas informações sozinho.",details:`Por que estou perguntando:

• Sem sua resposta, a importa\xe7\xe3o pode FALHAR ou criar dados incorretos
• Cada pergunta tem op\xe7\xf5es baseadas no que encontrei no arquivo
• Se nenhuma op\xe7\xe3o servir, use "Outros" para digitar manualmente

Estas perguntas s\xe3o OBRIGAT\xd3RIAS - n\xe3o consigo continuar sem elas.`,action:"Responda todas para eu poder finalizar a importação!"},sL={summary:"Estas perguntas refinam a importação. Se pular, uso valores padrão que funcionam na maioria dos casos.",details:`Quando voc\xea deve responder:

• Se quiser mais precis\xe3o nos dados importados
• Se conhece detalhes espec\xedficos deste arquivo
• Se j\xe1 teve problemas com valores padr\xe3o antes

Quando pode pular:
• Se for importa\xe7\xe3o padr\xe3o/rotineira
• Se n\xe3o tiver certeza da resposta`,action:"Opcional: responda se quiser mais precisão."},s$=()=>`O que aprendi com importa\xe7\xf5es anteriores:

• Quais colunas do SEU arquivo correspondem a quais campos
• Qual projeto geralmente est\xe1 associado a este tipo de arquivo
• Quais mapeamentos voc\xea costuma corrigir

Isso significa que fa\xe7o menos perguntas e acerto mais!`,sz=()=>"Se minhas sugestões estiverem boas, você pode confiar nelas!",sU={summary:"📝 Primeira vez com este tipo de arquivo! Suas respostas vão me ensinar para as próximas.",details:`O que acontece agora:

• Vou fazer mais perguntas que o normal
• Suas respostas v\xe3o direto para minha mem\xf3ria
• Nas pr\xf3ximas importa\xe7\xf5es similares, serei mais r\xe1pido e assertivo

\xc9 normal eu pedir mais confirma\xe7\xf5es na primeira vez!`,action:"Responda com atenção - você está me treinando!"},sV={summary:"Quer me dizer mais alguma coisa? Qualquer observação ajuda a melhorar minha análise!",details:`Use este campo para:

• Corrigir algo que errei nas perguntas acima
• Explicar algo espec\xedfico sobre este arquivo
• Dar contexto que pode me ajudar agora e no futuro

Exemplo: "A coluna EQUIP \xe9 o Part Number, n\xe3o o nome do equipamento"`,action:"Opcional: escreva se tiver algo a adicionar."},sH={summary:"Analisei suas respostas e preparei um resumo. Revise antes de confirmar a importação!",details:`O que verifico antes de importar:

• Todas as colunas obrigat\xf3rias mapeadas
• Nenhum dado duplicado ou inconsistente
• Quantidades e valores dentro do esperado
• Part Numbers existentes ou que ser\xe3o criados

S\xf3 vou importar ap\xf3s sua aprova\xe7\xe3o expl\xedcita.`,action:"Revise o resumo e aprove se estiver tudo certo!"},sQ={summary:"❌ Ops! Encontrei um problema. Veja abaixo como resolver.",details:`Solu\xe7\xf5es mais comuns:

1. Arquivo muito grande → M\xe1ximo 50MB
2. Formato n\xe3o suportado → Use XML, PDF, CSV, XLSX, JPG, PNG ou TXT
3. Arquivo corrompido → Reexporte do sistema de origem
4. Timeout → Arquivo muito complexo - tente dividir em partes menores
5. Erro de rede → Verifique sua conex\xe3o e tente novamente`,action:"Corrija o problema e clique em 'Tentar novamente'!"},sK={summary:"✅ Análise completa! Revise os dados e confirme se está tudo certo.",details:`O que foi feito:

• Estrutura do arquivo detectada
• Colunas mapeadas para campos do sistema
• Perguntas geradas para esclarecer d\xfavidas

Agora \xe9 sua vez de revisar e aprovar!`,action:"Revise os dados e clique em 'Confirmar Importação'."};function sJ(e){let s;return 0===e?sU:{summary:1===(s=({episodeCount:e}).episodeCount??0)?"🧠 Encontrei 1 importação similar! Estou usando esse conhecimento para preencher automaticamente.":`🧠 Encontrei ${s} importa\xe7\xf5es similares! Quanto mais voc\xea me usa, mais inteligente eu fico.`,details:s$?.({episodeCount:e})??"",action:sz?.({episodeCount:e})}}function sW({steps:e}){let[t,n]=(0,a.useState)(!1);if(0===e.length)return null;let l=t?e:e.slice(-3);return(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("button",{onClick:()=>n(!t),className:"flex items-center gap-2 text-sm text-text-muted hover:text-text-primary transition-colors",children:[(0,s.jsx)(ei.Lightbulb,{className:"w-4 h-4"}),(0,s.jsx)("span",{children:"Como NEXO está pensando"}),t?(0,s.jsx)(ee,{className:"w-4 h-4"}):(0,s.jsx)(Y.ChevronDown,{className:"w-4 h-4"}),(0,s.jsxs)($.Badge,{variant:"outline",className:"ml-auto",children:[e.length," passos"]})]}),(0,s.jsx)(r.AnimatePresence,{children:(0,s.jsxs)(i.motion.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},className:"space-y-2 pl-2 border-l-2 border-white/10",children:[(0,s.jsx)(sB,{summary:sF.summary,details:sF.details,action:sF.action,variant:"info",compact:!0}),l.map((e,a)=>(0,s.jsxs)(i.motion.div,{initial:{x:-10,opacity:0},animate:{x:0,opacity:1},transition:{delay:.1*a},className:"flex items-start gap-2 text-sm",children:[(e=>{switch(e){case"thought":return(0,s.jsx)(R.Brain,{className:"w-4 h-4 text-purple-400"});case"action":return(0,s.jsx)(e3.Play,{className:"w-4 h-4 text-cyan-400"});case"observation":return(0,s.jsx)(e1.Eye,{className:"w-4 h-4 text-green-400"})}})(e.type),(0,s.jsxs)("div",{children:[(0,s.jsxs)("span",{className:"text-text-muted text-xs",children:[(e=>{switch(e){case"thought":return"Pensando";case"action":return"Ação";case"observation":return"Observação"}})(e.type),":"]}),(0,s.jsx)("p",{className:"text-text-secondary",children:e.content})]})]},a))]})})]})}function sZ({sheets:e}){let a,t,r={summary:0===(a=Number((t={sheetCount:e.length}).sheetCount)||0)?"Não encontrei abas válidas. Verifique se o arquivo está correto.":1===a?"Arquivo simples! Vou processar todos os dados desta única aba.":`Encontrei ${a} abas. Verifique se identifiquei corretamente qual cont\xe9m os itens a importar!`,details:sR?.(t)??"",action:sM?.(t)};return(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-text-muted",children:[(0,s.jsx)(eE.FileSpreadsheet,{className:"w-4 h-4"}),(0,s.jsx)("span",{children:"Abas detectadas"}),(0,s.jsx)($.Badge,{variant:"outline",children:e.length})]}),(0,s.jsx)(sB,{summary:r.summary,details:r.details,action:r.action,variant:"tip",compact:!0}),(0,s.jsx)("div",{className:"grid gap-2",children:e.map((e,a)=>{let t,r=e.purpose??e.detected_purpose??"unknown",i=isNaN(t=e.confidence??e.purpose_confidence??0)?0:t;return(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg border border-white/10",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded bg-white/10 flex items-center justify-center text-sm font-medium",children:a+1}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:e.name}),(0,s.jsxs)("p",{className:"text-xs text-text-muted",children:[e.row_count.toLocaleString()," linhas · ",e.column_count," colunas"]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)($.Badge,{className:{items:"bg-cyan-500/20 text-cyan-400",serials:"bg-purple-500/20 text-purple-400",metadata:"bg-yellow-500/20 text-yellow-400",summary:"bg-green-500/20 text-green-400",config:"bg-blue-500/20 text-blue-400",unknown:"bg-gray-500/20 text-gray-400"}[r??"unknown"]??"bg-gray-500/20 text-gray-400",children:{items:"Itens",serials:"Seriais",metadata:"Metadados",summary:"Resumo",config:"Configuração",unknown:"Desconhecido"}[r??"unknown"]??"Desconhecido"}),(0,s.jsxs)($.Badge,{variant:"outline",children:[Math.round(100*i),"%"]})]})]},a)})})]})}function sY({mappings:e}){var t,r,i,n;let l,o,c,d,m,[x,u]=(0,a.useState)(!1),p=e.filter(e=>e.confidence>=.8),h=e.filter(e=>e.confidence>=.5&&e.confidence<.8),g=e.filter(e=>e.confidence<.5),j=x?e:e.slice(0,5),f=(t=p.length,{summary:(l=Number((n=m={total:t+(r=h.length)+(i=g.length),high:t,medium:r,low:i}).total)||0,o=Number(n.high)||0,c=Number(n.low)||0,d=Number(n.medium)||0,0===l?"Ainda analisando as colunas...":c>0?`⚠️ ${c} colunas com baixa confian\xe7a precisam da sua aten\xe7\xe3o! Responda as perguntas abaixo.`:o===l?`✅ Tenho alta confian\xe7a em todos os ${l} mapeamentos. Pode prosseguir!`:`A maioria est\xe1 ok, mas verifique os ${d} mapeamentos de m\xe9dia confian\xe7a.`),details:sG?.(m)??sG?.({})??"",action:sX?.(m)});return(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-text-muted",children:[(0,s.jsx)(e5,{className:"w-4 h-4"}),(0,s.jsx)("span",{children:"Mapeamento de colunas"})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)($.Badge,{className:"bg-green-500/20 text-green-400",children:[p.length," alta"]}),(0,s.jsxs)($.Badge,{className:"bg-yellow-500/20 text-yellow-400",children:[h.length," média"]}),(0,s.jsxs)($.Badge,{className:"bg-red-500/20 text-red-400",children:[g.length," baixa"]})]})]}),(0,s.jsx)(sB,{summary:f.summary,details:f.details,action:f.action,variant:"tip",compact:!0}),(0,s.jsx)("div",{className:"space-y-1",children:j.map((e,a)=>{var t;return(0,s.jsxs)("div",{className:"flex items-center justify-between p-2 bg-white/5 rounded text-sm",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-text-muted",children:e.file_column}),(0,s.jsx)("span",{className:"text-text-muted",children:"→"}),(0,s.jsx)("span",{className:"font-medium",children:e.target_field})]}),(0,s.jsxs)("span",{className:(t=e.confidence)>=.8?"text-green-400":t>=.5?"text-yellow-400":"text-red-400",children:[Math.round(100*e.confidence),"%"]})]},a)})}),e.length>5&&(0,s.jsx)("button",{onClick:()=>u(!x),className:"text-sm text-cyan-400 hover:underline",children:x?"Mostrar menos":`Ver todas ${e.length} colunas`})]})}function s0({questions:e,answers:t,onAnswer:r,onSubmit:i,onSkip:n,isSubmitting:o}){let[c,d]=(0,a.useState)({}),[m,x]=(0,a.useState)(""),u=e.filter(e=>"unmapped"===e.topic),p=e.filter(e=>"unmapped"!==e.topic),h=p.filter(e=>"critical"===e.importance),g=p.filter(e=>"critical"!==e.importance),j=h.every(e=>{let s=t[e.id];return"__other__"===s?c[e.id]?.trim().length>0:!!s}),f=u.every(e=>!!t[e.id]),b=(e,s)=>{d(a=>({...a,[e]:s}))},v=e=>(0,s.jsx)($.Badge,{className:{critical:"bg-red-500/20 text-red-400",high:"bg-orange-500/20 text-orange-400",medium:"bg-yellow-500/20 text-yellow-400",low:"bg-gray-500/20 text-gray-400"}[e],children:{critical:"Obrigatório",high:"Importante",medium:"Opcional",low:"Opcional"}[e]});return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(e4,{className:"w-5 h-5 text-purple-400"}),(0,s.jsx)("h3",{className:"font-medium",children:"NEXO precisa da sua ajuda"}),(0,s.jsxs)($.Badge,{variant:"outline",children:[e.length," perguntas"]})]}),u.length>0&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-orange-500/10 rounded-lg border border-orange-500/20",children:[(0,s.jsx)(J.AlertTriangle,{className:"w-5 h-5 text-orange-400"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"text-sm font-medium text-orange-300",children:[u.length," coluna(s) não existe(m) no banco de dados"]}),(0,s.jsx)("p",{className:"text-xs text-orange-200/70",children:"Escolha o que fazer com cada coluna antes de continuar"})]})]}),u.map(e=>(0,s.jsx)(s1,{question:e,answer:t[e.id],onAnswer:r},e.id))]}),h.length>0&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("p",{className:"text-sm text-text-muted flex items-center gap-2",children:[(0,s.jsx)(J.AlertTriangle,{className:"w-4 h-4 text-red-400"}),"Estas respostas são necessárias para continuar:"]}),(0,s.jsx)(sB,{summary:sD.summary,details:sD.details,action:sD.action,variant:"warning",compact:!0}),h.map(e=>(0,s.jsx)(s2,{question:e,answer:t[e.id],otherText:c[e.id],onAnswer:r,onOtherTextChange:b,importanceBadge:v(e.importance)},e.id))]}),g.length>0&&(0,s.jsxs)("div",{className:"space-y-4 pt-4 border-t border-white/10",children:[(0,s.jsx)("p",{className:"text-sm text-text-muted",children:"Perguntas opcionais (respostas padrão serão usadas se não responder):"}),(0,s.jsx)(sB,{summary:sL.summary,details:sL.details,action:sL.action,variant:"info",compact:!0}),g.map(e=>(0,s.jsx)(s2,{question:e,answer:t[e.id],otherText:c[e.id],onAnswer:r,onOtherTextChange:b,importanceBadge:v(e.importance)},e.id))]}),(0,s.jsxs)("div",{className:"space-y-3 pt-4 border-t border-white/10",children:[(0,s.jsx)(sB,{summary:sV.summary,details:sV.details,action:sV.action,variant:"tip",compact:!0}),(0,s.jsx)("textarea",{value:m,onChange:e=>x(e.target.value),placeholder:"Ex: A coluna 'EQUIP' na verdade é o Part Number, não o nome do equipamento...",className:"w-full p-3 bg-white/5 border border-white/10 rounded-lg text-sm text-text-primary placeholder:text-text-muted/50 focus:outline-none focus:ring-2 focus:ring-faiston-magenta-light/50 focus:border-transparent resize-none",rows:3})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,s.jsx)(l.Button,{variant:"outline",onClick:n,disabled:o,children:"Pular e usar padrões"}),(0,s.jsx)(l.Button,{onClick:()=>{let e={};Object.keys(t).forEach(s=>{let a=t[s];if("__other__"===a){let a=c[s]?.trim();a&&(e[s]=`Outros: ${a}`)}else e[s]=a}),i(m.trim(),e)},disabled:!(j&&f)||o,className:"bg-gradient-to-r from-cyan-500 to-purple-500 text-white",children:o?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eM.Loader2,{className:"w-4 h-4 mr-2 animate-spin"}),"Processando..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(T.CheckCircle2,{className:"w-4 h-4 mr-2"}),"Confirmar respostas"]})})]})]})}function s2({question:e,answer:a,otherText:t,onAnswer:r,onOtherTextChange:i,importanceBadge:n}){let l=(e.options||[]).map((e,s)=>{var a,t;return a=e,t=s,"string"==typeof a?{value:a.toLowerCase().replace(/\s+/g,"_"),label:a}:{value:a.value||a.label||`option_${t}`,label:a.label||a.value||`Op\xe7\xe3o ${t+1}`,description:a.description}});return(0,s.jsxs)("div",{className:"p-4 bg-white/5 rounded-lg border border-white/10 space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:e.question}),e.context&&(0,s.jsxs)("p",{className:"text-sm text-text-muted mt-1 flex items-start gap-2",children:[(0,s.jsx)(e8.Info,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.context]})]}),n]}),(0,s.jsxs)(sC,{value:a??"",onValueChange:s=>r(e.id,s),className:"space-y-2",children:[l.map(a=>(0,s.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,s.jsx)(sk,{value:a.value,id:`${e.id}-${a.value}`,className:"mt-1"}),(0,s.jsxs)(E.Label,{htmlFor:`${e.id}-${a.value}`,className:"flex-1 cursor-pointer",children:[(0,s.jsx)("span",{className:"font-medium",children:a.label}),a.description&&(0,s.jsx)("p",{className:"text-sm text-text-muted",children:a.description})]})]},a.value)),(0,s.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,s.jsx)(sk,{value:"__other__",id:`${e.id}-__other__`,className:"mt-1"}),(0,s.jsxs)(E.Label,{htmlFor:`${e.id}-__other__`,className:"flex-1 cursor-pointer",children:[(0,s.jsx)("span",{className:"font-medium",children:"Outros"}),(0,s.jsx)("p",{className:"text-sm text-text-muted",children:"Especificar uma resposta diferente"})]})]})]}),"__other__"===a&&(0,s.jsx)("div",{className:"mt-3 pl-7",children:(0,s.jsx)("textarea",{value:t||"",onChange:s=>i?.(e.id,s.target.value),placeholder:"Descreva sua resposta...",className:"w-full px-3 py-2 bg-white/5 border border-white/20 rounded-lg text-sm placeholder:text-text-muted focus:outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-purple-500/50 resize-none",rows:3})})]})}function s1({question:e,answer:a,onAnswer:t}){let r="request_db_update"===a&&e.it_contact_note;return(0,s.jsxs)("div",{className:"p-4 bg-orange-500/5 rounded-lg border border-orange-500/20 space-y-4",children:[(0,s.jsx)("div",{className:"flex items-start justify-between gap-4",children:(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsx)(J.AlertTriangle,{className:"w-4 h-4 text-orange-400"}),(0,s.jsx)($.Badge,{className:"bg-orange-500/20 text-orange-400 text-xs",children:"Coluna não mapeada"}),e.blocking&&(0,s.jsx)($.Badge,{className:"bg-red-500/20 text-red-400 text-xs",children:"Bloqueante"})]}),(0,s.jsx)("p",{className:"font-medium text-orange-200",children:e.question}),e.context&&(0,s.jsx)("p",{className:"text-sm text-text-muted mt-1",children:e.context})]})}),(0,s.jsx)(sC,{value:a??"",onValueChange:s=>t(e.id,s),className:"space-y-3",children:e.options.map(a=>{let t=a.warning,r=a.recommended,i=a.contact_it,n=t?"bg-red-500/10 border-red-500/20 hover:bg-red-500/15":r?"bg-green-500/10 border-green-500/20 hover:bg-green-500/15":i?"bg-blue-500/10 border-blue-500/20 hover:bg-blue-500/15":"bg-white/5 border-white/10 hover:bg-white/10";return(0,s.jsx)("div",{className:`p-3 rounded-lg border transition-colors ${n}`,children:(0,s.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,s.jsx)(sk,{value:a.value,id:`${e.id}-${a.value}`,className:"mt-1"}),(0,s.jsxs)(E.Label,{htmlFor:`${e.id}-${a.value}`,className:"flex-1 cursor-pointer",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"font-medium",children:a.label}),t&&(0,s.jsx)($.Badge,{className:"bg-red-500/30 text-red-300 text-xs",children:"⚠️ Dados perdidos"}),r&&(0,s.jsx)($.Badge,{className:"bg-green-500/30 text-green-300 text-xs",children:"✓ Recomendado"}),i&&(0,s.jsx)($.Badge,{className:"bg-blue-500/30 text-blue-300 text-xs",children:"📧 Contatar TI"})]}),a.description&&(0,s.jsx)("p",{className:"text-sm text-text-muted mt-1",children:a.description})]})]})},a.value)})}),r&&(0,s.jsx)(i.motion.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"p-3 bg-blue-500/10 rounded-lg border border-blue-500/20",children:(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[(0,s.jsx)(e8.Info,{className:"w-4 h-4 text-blue-400 flex-shrink-0 mt-0.5"}),(0,s.jsx)("p",{className:"text-sm text-blue-200",children:e.it_contact_note})]})})]})}function s4({columns:e,message:a,onCancel:t}){return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(ec.XCircle,{className:"w-6 h-6 text-red-400"}),(0,s.jsx)("h3",{className:"text-lg font-semibold text-red-300",children:"Importação Bloqueada - Campos Faltantes"})]}),(0,s.jsxs)("div",{className:"bg-red-500/10 border border-red-500/30 rounded-xl p-6 space-y-4",children:[(0,s.jsx)("p",{className:"text-white/70",children:a||"Os seguintes campos não existem no banco de dados:"}),(0,s.jsx)("ul",{className:"space-y-2 font-mono text-sm",children:e.map(e=>(0,s.jsxs)("li",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"px-2 py-0.5 rounded bg-purple-500/20 text-purple-300",children:e.type}),(0,s.jsx)("span",{className:"text-white",children:e.name}),(0,s.jsxs)("span",{className:"text-white/40",children:["← “",e.source,"”"]})]},e.name))}),(0,s.jsxs)("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-4 space-y-2",children:[(0,s.jsxs)("p",{className:"text-blue-200 text-sm",children:[(0,s.jsx)("strong",{children:"Ação necessária:"})," Contacte a equipe de tecnologia para criar estes campos na tabela ",(0,s.jsx)("code",{className:"bg-blue-500/20 px-1 rounded",children:"sga.pending_entry_items"}),"."]}),(0,s.jsx)("p",{className:"text-blue-200/70 text-sm",children:"Após a criação dos campos, faça upload do arquivo novamente para uma nova análise."})]})]}),(0,s.jsx)("div",{className:"flex justify-end pt-4 border-t border-white/10",children:(0,s.jsxs)(l.Button,{variant:"outline",onClick:t,className:"border-red-500/30 text-red-300 hover:bg-red-500/10",children:[(0,s.jsx)(ec.XCircle,{className:"w-4 h-4 mr-2"}),"Cancelar Importação"]})})]})}function s5({reviewSummary:e,userFeedback:a,onApprove:t,onBack:r,onCancel:n,isSubmitting:o}){return e.isBlocked&&e.missingColumns&&e.missingColumns.length>0?(0,s.jsx)(s4,{columns:e.missingColumns,message:e.blockMessage||"Campos faltantes no banco de dados.",onCancel:n}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(T.CheckCircle2,{className:"w-5 h-5 text-green-400"}),(0,s.jsx)("h3",{className:"font-medium",children:"Resumo da Importação"})]}),(0,s.jsx)(sB,{summary:sH.summary,details:sH.details,action:sH.action,variant:"success"}),(0,s.jsxs)("div",{className:"p-4 bg-white/5 rounded-lg border border-white/10 space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(eE.FileSpreadsheet,{className:"w-5 h-5 text-cyan-400"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:e.filename}),(0,s.jsxs)("p",{className:"text-sm text-text-muted",children:["Aba principal: ",e.mainSheet]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 pt-3 border-t border-white/10",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-text-muted",children:"Total de itens"}),(0,s.jsx)("p",{className:"text-xl font-bold text-cyan-400",children:e.totalItems.toLocaleString()})]}),e.projectName&&(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-text-muted",children:"Projeto"}),(0,s.jsx)("p",{className:"text-lg font-medium",children:e.projectName})]})]}),e.validations.length>0&&(0,s.jsxs)("div",{className:"pt-3 border-t border-white/10",children:[(0,s.jsxs)("p",{className:"text-sm text-text-muted mb-2 flex items-center gap-2",children:[(0,s.jsx)(T.CheckCircle2,{className:"w-4 h-4 text-green-400"}),"Validações OK:"]}),(0,s.jsx)("ul",{className:"space-y-1",children:e.validations.map((e,a)=>(0,s.jsxs)("li",{className:"text-sm text-text-secondary flex items-start gap-2",children:[(0,s.jsx)("span",{className:"text-green-400",children:"✓"}),e]},a))})]}),e.warnings.length>0&&(0,s.jsxs)("div",{className:"pt-3 border-t border-white/10",children:[(0,s.jsxs)("p",{className:"text-sm text-text-muted mb-2 flex items-center gap-2",children:[(0,s.jsx)(J.AlertTriangle,{className:"w-4 h-4 text-yellow-400"}),"Atenção:"]}),(0,s.jsx)("ul",{className:"space-y-1",children:e.warnings.map((e,a)=>(0,s.jsxs)("li",{className:"text-sm text-yellow-400 flex items-start gap-2",children:[(0,s.jsx)("span",{children:"⚠"}),e]},a))})]}),e.newColumns&&e.newColumns.length>0&&(0,s.jsxs)("div",{className:"pt-3 border-t border-white/10",children:[(0,s.jsxs)("p",{className:"text-sm text-text-muted mb-2 flex items-center gap-2",children:[(0,s.jsx)(e5,{className:"w-4 h-4 text-purple-400"}),"Novos campos a criar no banco de dados:"]}),(0,s.jsx)("div",{className:"space-y-2",children:e.newColumns.map((e,a)=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-2 bg-purple-500/10 rounded border border-purple-500/20",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)($.Badge,{className:"bg-purple-500/20 text-purple-400 text-xs",children:e.inferredType}),(0,s.jsx)("span",{className:"text-sm font-medium text-text-primary",children:e.name})]}),(0,s.jsx)("span",{className:"text-xs text-text-muted",children:e.sourceFileColumn&&`de "${e.sourceFileColumn}"`})]},a))}),(0,s.jsx)("p",{className:"text-xs text-text-muted mt-2 italic",children:"Estes campos serão criados automaticamente no schema do banco de dados."})]}),a&&(0,s.jsxs)("div",{className:"pt-3 border-t border-white/10",children:[(0,s.jsxs)("p",{className:"text-sm text-text-muted mb-2 flex items-center gap-2",children:[(0,s.jsx)(e4,{className:"w-4 h-4 text-purple-400"}),"Seu feedback:"]}),(0,s.jsxs)("p",{className:"text-sm text-text-secondary italic",children:["“",a,"”"]})]})]}),(0,s.jsx)(i.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"p-4 bg-gradient-to-r from-green-500/10 to-cyan-500/10 rounded-lg border border-green-500/20",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)(W.Sparkles,{className:"w-5 h-5 text-green-400 flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-green-400",children:"Recomendação NEXO"}),(0,s.jsx)("p",{className:"text-sm text-text-secondary mt-1",children:e.recommendation})]})]})}),(0,s.jsxs)("div",{className:"flex justify-between items-center pt-4 border-t border-white/10",children:[(0,s.jsxs)(l.Button,{variant:"ghost",onClick:r,disabled:o,className:"text-text-muted hover:text-text-primary",children:[(0,s.jsx)(ee,{className:"w-4 h-4 mr-2"}),"Voltar e editar respostas"]}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)(l.Button,{variant:"outline",onClick:n,disabled:o,children:"Cancelar"}),(0,s.jsx)(l.Button,{onClick:t,disabled:o||!e.readyToImport,className:"bg-gradient-to-r from-green-500 to-cyan-500 text-white",children:o?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eM.Loader2,{className:"w-4 h-4 mr-2 animate-spin"}),"Importando..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(T.CheckCircle2,{className:"w-4 h-4 mr-2"}),"Aprovar e Importar"]})})]})]})]})}function s3({file:e,onComplete:t,onCancel:n}){let{state:o,isAnalyzing:c,isRecalling:d,hasQuestions:m,isReadyToProcess:x,isReviewing:u,startAnalysis:p,answerQuestion:h,submitAllAnswers:g,skipQuestions:j,approveAndImport:f,backToQuestions:b,reasoningTrace:v,currentThought:N,priorKnowledge:y,reviewSummary:w}=function(){let[e,s]=(0,a.useState)(sI),t=(0,a.useMemo)(()=>"analyzing"===e.stage,[e.stage]),r=(0,a.useMemo)(()=>"recalling"===e.stage,[e.stage]),i=(0,a.useMemo)(()=>e.questions.length>0&&"questioning"===e.stage,[e.questions,e.stage]),n=(0,a.useMemo)(()=>null!==e.analysis&&(0===e.questions.length||Object.keys(e.answers).length>=e.questions.filter(e=>"critical"===e.importance).length),[e.analysis,e.questions,e.answers]),l=(0,a.useMemo)(()=>{if(!e.analysis?.reasoningTrace)return null;let s=e.analysis.reasoningTrace.filter(e=>"thought"===e.type);return s.length>0?s[s.length-1].content:null},[e.analysis?.reasoningTrace]),o=(0,a.useMemo)(()=>"reviewing"===e.stage,[e.stage]),c=(0,a.useCallback)((e,a,t,r)=>{s(s=>({...s,stage:e,progress:{stage:e,percent:a,message:t,currentStep:r}}))},[]),d=(0,a.useCallback)(async e=>{c("uploading",5,"Preparando upload...","upload"),(0,D.clearSGASession)();let a=null;try{c("uploading",10,"Obtendo URL de upload...");let t=e.type||"application/octet-stream",r=await (0,D.getNFUploadUrl)({filename:e.name,content_type:t}),i=(0,sE.extractAgentResponse)(r.data);if(!i?.upload_url||!i?.s3_key)throw Error("Falha ao obter URL de upload");c("uploading",30,"Enviando arquivo...");let n=i.required_headers||{"Content-Type":t};if(!(await fetch(i.upload_url,{method:"PUT",body:e,headers:n})).ok)throw Error("Falha no upload do arquivo");c("recalling",35,"NEXO consultando memória...","recall");let l=null,o=.75;try{let[s,a]=await Promise.all([(0,D.nexoGetPriorKnowledge)({filename:e.name}),(0,D.nexoGetAdaptiveThreshold)({filename:e.name})]);s.data?.success&&s.data?.has_prior_knowledge&&(l=s.data.prior_knowledge,console.log("[NEXO] Prior knowledge retrieved:",l)),a.data?.success&&(o=a.data.threshold,console.log("[NEXO] Adaptive threshold:",o,a.data.reason||"(default)"))}catch(e){console.warn("[NEXO] Prior knowledge retrieval failed (continuing):",e)}s(e=>({...e,priorKnowledge:l,adaptiveThreshold:o})),c("analyzing",50,"NEXO analisando arquivo...","observe");let d=await (0,D.nexoAnalyzeFile)({s3_key:i.s3_key,filename:e.name,content_type:t,prior_knowledge:l?{suggested_mappings:l.suggested_mappings,confidence_boost:l.confidence_boost,reflections:l.reflections}:void 0});if(!d.data?.success){let e=d.data?.error,s="string"==typeof e?e.trim():e;if("success"===s||'"success"'===s||"'success'"===s||"string"==typeof s&&s.includes("success")&&s.length<15){console.warn('[NEXO] BUG-022 v10: Detected "success" as error value - semantic mismatch:',e);let s=d.data;if(console.log("[NEXO] BUG-022 v11 DEBUG: Received data keys:",Object.keys(s||{})),"sheets"in s||"file_analysis"in s||"column_mappings"in s||s?.analysis?.sheets||s?.response?.analysis)console.info("[NEXO] BUG-022 v12: Meaningful data present, treating as success"),d.data.success=!0,delete d.data.error;else throw console.error("[NEXO] BUG-022 v12: No meaningful data found. Keys:",Object.keys(s||{})),Error("Falha na análise: resposta malformada do servidor")}else{let s=d.data,t=s?.error_type,r=(0,sE.safeExtractErrorMessage)(e)||"Falha na análise (sem detalhes)";throw console.error("[NEXO] Analysis failed:",{error:r,error_type:t},d.data),(a=d.debug_analysis??s?.debug_analysis??null)&&console.log("[NEXO] BUG-039: Debug analysis captured:",a.error_type),Error(r)}}let m=(0,sE.extractAgentResponse)(d.data);if(!(0,sS.hasValidAnalysisData)(m))throw console.error("[NEXO] BUG-020 v6: Backend response missing analysis data:",m),Error("Erro ao analisar arquivo: resposta incompleta do servidor");let x=(0,sS.normalizeNexoResponse)(m);console.log("[NEXO] BUG-022 v14: Normalized response structure:",Object.keys(x));let u={sessionId:x.import_session_id,filename:x.filename,detectedType:x.detected_file_type,sheets:x.analysis.sheets,columnMappings:x.column_mappings,overallConfidence:x.overall_confidence,mappingConfidence:x.mapping_confidence,mappingComplete:x.mapping_complete,recommendedStrategy:x.analysis.recommended_strategy,reasoningTrace:x.reasoning_trace},p=x.session_state||{session_id:x.import_session_id,filename:x.filename,s3_key:i.s3_key,stage:x.questions&&x.questions.length>0?"questioning":"processing",file_analysis:{sheets:x.analysis.sheets,sheet_count:x.analysis.sheet_count,total_rows:x.analysis.total_rows,detected_type:x.detected_file_type,recommended_strategy:x.analysis.recommended_strategy},reasoning_trace:x.reasoning_trace,questions:x.questions,answers:{},learned_mappings:{},ai_instructions:{},requested_new_columns:[],column_mappings:x.column_mappings.reduce((e,s)=>(e[s.file_column]=s.target_field,e),{}),confidence:{overall:x.overall_confidence,extraction_quality:1,evidence_strength:1,historical_match:1,risk_level:x.overall_confidence>=.8?"low":x.overall_confidence>=.5?"medium":"high",factors:[],requires_hil:x.overall_confidence<.6},error:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},h=x.questions||[],g=(x.unmapped_questions||[]).map(e=>({id:e.id,question:e.question,context:e.description,importance:"critical",topic:"unmapped",options:e.options?.map(e=>({value:e.value,label:e.label,description:e.description,warning:e.warning,recommended:e.recommended,contact_it:e.contact_it}))||[],column:e.column,suggested_action:e.suggested_action,blocking:e.blocking,it_contact_note:e.it_contact_note})),j=[...g,...h];if(j.length>0){let e=g.length,a=e>0?`NEXO encontrou ${e} coluna(s) n\xe3o mapeada(s)...`:"NEXO tem perguntas para você...";c("questioning",70,a,"ask"),s(e=>({...e,stage:"questioning",analysis:u,sessionState:p,questions:j,progress:{stage:"questioning",percent:70,message:"Aguardando suas respostas...",currentStep:"ask"}}))}else c("processing",80,"Preparando para processamento...","act"),s(e=>({...e,stage:"processing",analysis:u,sessionState:p,questions:[],progress:{stage:"processing",percent:80,message:"Pronto para processar",currentStep:"act"}}));return u}catch(t){let e=(0,sE.safeExtractErrorMessage)(t instanceof Error?t.message:"Erro na análise");throw s(s=>({...s,stage:"error",error:e,progress:{stage:"error",percent:0,message:e},debugAnalysis:a})),t}},[c]),m=(0,a.useCallback)((e,a)=>{s(s=>({...s,answers:{...s.answers,[e]:a}}))},[]),x=(0,a.useCallback)(async(a,t)=>{if(!e.sessionState)throw Error("Nenhuma sessão de importação ativa");let r=t||e.answers;c("re-analyzing",70,"NEXO reanalisando com suas respostas...","re-think");let i=0,n=setInterval(()=>{s(e=>{let s=Math.min(e.progress.percent+2,90);return i=(i+1)%sA.length,{...e,progress:{...e.progress,percent:s,message:sA[i]}}})},2e3);try{let t={...e.sessionState,answers:{...e.sessionState.answers,...r},updated_at:new Date().toISOString()},i=await (0,D.nexoSubmitAnswers)({session_state:t,answers:r,user_feedback:a});if(clearInterval(n),console.log("[NEXO] Submit answers response:",{success:i.data?.success,remaining_questions:i.data?.remaining_questions?.length||0,ready_for_processing:i.data?.ready_for_processing,will_continue_questioning:!!i.data?.remaining_questions?.length,confidence:i.data?.confidence,validation_errors:i.data?.validation_errors,re_reasoning_applied:i.data?.re_reasoning_applied}),!i.data?.success){if(i.data?.error==="re_reasoning_failed"&&(console.warn("[NEXO] Re-reasoning failed, HIL required:",i.data.re_reasoning_error),i.data.remaining_questions&&i.data.remaining_questions.length>0)){s(e=>({...e,stage:"questioning",sessionState:i.data.session||e.sessionState,questions:i.data.remaining_questions,progress:{stage:"questioning",percent:70,message:"Análise automática falhou. Revisão necessária.",currentStep:"hil"},error:null})),clearInterval(n);return}if(i.data?.validation_errors&&i.data.validation_errors.length>0){console.warn("[NEXO] Schema validation failed:",i.data.validation_errors);let e=i.data.validation_errors.map(sq).join("\n• ");throw Error(`Valida\xe7\xe3o de schema falhou:
• ${e}`)}let e=(0,sE.safeExtractErrorMessage)(i.data?.error)||"Sessão expirada. Por favor, faça upload do arquivo novamente.";throw Error(e)}let l=i.data.session||t;if(i.data.remaining_questions&&i.data.remaining_questions.length>0)s(e=>({...e,stage:"questioning",sessionState:l,questions:i.data.remaining_questions,progress:{stage:"questioning",percent:75,message:"Mais perguntas...",currentStep:"ask"}}));else{let t=e.analysis?.sheets??[],r=e.analysis?.columnMappings??[],n=t.find(e=>"items"===e.purpose)||t[0],o=e.answers.project||e.answers.projeto||null,d=r.filter(e=>e.confidence>=.8),m=r.filter(e=>e.confidence<.5),x=[`${d.length} colunas mapeadas com alta confian\xe7a`,"Estrutura do arquivo validada",n?`Aba principal identificada: ${n.name}`:""].filter(Boolean),u=m.length>0?[`${m.length} colunas com baixa confian\xe7a (usando valores padr\xe3o)`]:[],p=null,h=i.data?.aggregation;h?.enabled&&(p={enabled:!0,strategy:h.strategy,uniqueParts:h.unique_parts||0,totalRows:h.total_rows||0,partNumberColumn:h.part_number_column},x.push(`Agrega\xe7\xe3o ativa: ${h.total_rows} linhas → ${h.unique_parts} Part Numbers \xfanicos`),console.log("[NEXO] Aggregation enabled:",p));let g=(l.requested_new_columns||[]).filter(e=>e.approved).map(e=>({name:e.name,originalName:e.original_name,userIntent:e.user_intent,inferredType:e.inferred_type,sourceFileColumn:e.source_file_column,approved:e.approved}));g.length>0&&x.push(`${g.length} novo(s) campo(s) ser\xe1(\xe3o) criado(s) no banco de dados`);let j={filename:e.analysis?.filename||"Desconhecido",mainSheet:n?.name||"Desconhecida",totalItems:p?.enabled?p.uniqueParts:n?.row_count||0,projectName:o,newPartNumbers:0,validations:x,warnings:u,recommendation:"Acho que está tudo certo! Podemos prosseguir com a importação.",readyToImport:!0,userFeedback:a||null,aggregation:p,newColumns:g.length>0?g:void 0};console.log("[NEXO] Transitioning to reviewing stage with reviewSummary:",{filename:j.filename,totalItems:j.totalItems,validations:j.validations.length,readyToImport:j.readyToImport}),c("reviewing",80,"Aguardando aprovação","review"),s(e=>({...e,stage:"reviewing",sessionState:l,questions:[],reviewSummary:j,userFeedback:a||null}))}}catch(a){clearInterval(n);let e=(0,sE.safeExtractErrorMessage)(a instanceof Error?a.message:"Erro ao processar respostas");throw s(s=>({...s,error:e})),a}},[e.analysis,e.sessionState,e.answers,c]),u=(0,a.useCallback)(async()=>{if(!e.sessionState)throw Error("Nenhuma sessão de importação ativa");let a={};e.questions.forEach(e=>{e.default_value?a[e.id]=e.default_value:e.options.length>0&&(a[e.id]=e.options[0].value)}),s(e=>({...e,answers:{...e.answers,...a}})),await x()},[e.sessionState,e.questions,x]),p=(0,a.useCallback)(()=>{c("questioning",70,"Revise suas respostas...","ask"),s(e=>({...e,stage:"questioning",reviewSummary:null}))},[c]),h=(0,a.useCallback)(async()=>{if(!e.sessionState)throw Error("Nenhuma sessão de importação ativa");console.log("[NEXO] prepareProcessing: Starting with session:",{session_id:e.sessionState.session_id,filename:e.sessionState.filename,learned_mappings_count:Object.keys(e.sessionState.learned_mappings||{}).length,requested_new_columns_count:(e.sessionState.requested_new_columns||[]).length}),c("processing",85,"Preparando configuração final...","act");try{let a=await (0,D.nexoPrepareProcessing)({session_state:e.sessionState});if(console.log("[NEXO] prepareProcessing: Backend response:",{success:a.data?.success,ready:a.data?.ready,error:a.data?.error,import_blocked:a.data?.import_blocked,missing_columns:a.data?.missing_columns,validation_errors:a.data?.validation_errors,column_mappings_count:a.data?.column_mappings?.length}),a.data?.import_blocked&&a.data?.missing_columns){console.warn("[NEXO] Import blocked - missing columns:",a.data.missing_columns);let t={filename:e.sessionState?.filename||"unknown",mainSheet:e.analysis?.sheets[0]?.name||"unknown",totalItems:0,projectName:null,newPartNumbers:0,validations:[],warnings:[],recommendation:"",readyToImport:!1,userFeedback:null,isBlocked:!0,missingColumns:a.data.missing_columns,blockMessage:a.data.message||"Campos faltantes no banco de dados."};return c("reviewing",80,"Importação bloqueada","blocked"),s(e=>({...e,stage:"reviewing",reviewSummary:t,error:null})),a.data}if(!a.data?.success||!a.data?.ready){if(a.data?.validation_errors&&a.data.validation_errors.length>0){console.warn("[NEXO] Schema validation failed:",a.data.validation_errors);let e=a.data.validation_errors.map(sq).join("\n• ");throw Error(`Valida\xe7\xe3o de schema falhou:
• ${e}`)}throw Error(a.data?.error||"Configuração não está pronta")}return s(e=>({...e,processingConfig:a.data,progress:{stage:"processing",percent:90,message:"Configuração pronta!",currentStep:"act"}})),a.data}catch(a){let e=(0,sE.safeExtractErrorMessage)(a instanceof Error?a.message:"Erro ao preparar processamento");throw s(s=>({...s,error:e})),a}},[e.sessionState,c]),g=(0,a.useCallback)(async(a,t,r)=>{let i=r||e.processingConfig;if(!e.sessionState||!i)throw Error("Preparação não concluída");console.log("[NEXO] executeNexoImport: Starting with params:",{import_id:e.sessionState.session_id,s3_key:e.sessionState.s3_key,filename:e.sessionState.filename,column_mappings_count:i.column_mappings?.length,projectId:a,locationId:t}),c("importing",92,"Executando importação...","act");try{let r=await (0,D.executeNexoImport)({session_state:e.sessionState,s3_key:e.sessionState.s3_key,filename:e.sessionState.filename,column_mappings:i.column_mappings,project_id:a,destination_location_id:t});if(console.log("[NEXO] executeNexoImport: Backend response:",{is_async:r.data?.is_async,job_id:r.data?.job?.job_id,success:r.data?.result?.success,error:r.data?.result?.error}),r.data?.is_async&&r.data?.job){let e=r.data.job;return console.log("[NEXO] executeNexoImport: Async job queued:",e.job_id),c("job_queued",100,e.human_message||"Processando em segundo plano...","queued"),s(e=>({...e,stage:"job_queued"})),{isAsync:!0,jobId:e.job_id,humanMessage:e.human_message}}let n=r.data?.result;if(!n?.success){let e=(0,sE.safeExtractErrorMessage)(n?.error)||(n?.failed_rows&&n.failed_rows.length>0?n.failed_rows.map(e=>e.reason).join(", "):"Falha na importação");throw Error(e)}return c("complete",100,"Importação concluída!","complete"),s(e=>({...e,stage:"complete"})),{isAsync:!1}}catch(a){let e=(0,sE.safeExtractErrorMessage)(a instanceof Error?a.message:"Erro na importação");throw s(s=>({...s,stage:"error",error:e,progress:{stage:"error",percent:0,message:e}})),a}},[e.sessionState,e.processingConfig,c]),j=(0,a.useCallback)(async(s,a)=>{if(e.sessionState){c("learning",95,"NEXO aprendendo com este importação...","learn");try{await (0,D.nexoLearnFromImport)({session_state:e.sessionState,import_result:s,user_corrections:a}),console.log("[NEXO] Aprendizado concluído")}catch(e){console.warn("[NEXO] Falha ao aprender:",e)}}},[e.sessionState,c]),f=(0,a.useCallback)(async()=>{if(!e.sessionState||!e.reviewSummary)throw Error("Nenhuma sessão de revisão ativa");console.log("[NEXO] approveAndImport: Starting import process..."),c("processing",85,"Preparando importação...","act"),s(e=>({...e,stage:"processing"})),console.log("[NEXO] approveAndImport: Calling prepareProcessing...");let a=await h();console.log("[NEXO] approveAndImport: prepareProcessing returned:",{success:a?.success,ready:a?.ready,mappingsCount:a?.column_mappings?.length}),console.log("[NEXO] approveAndImport: Calling executeNexoImport...");let t=await g(e.answers.project||e.answers.projeto||void 0,e.answers.location||e.answers.local||void 0,a);return t.isAsync?(console.log("[NEXO] approveAndImport: Async job queued, skipping learning (backend handles it)"),t):(console.log("[NEXO] approveAndImport: executeNexoImport completed successfully (sync)"),console.log("[NEXO] approveAndImport: Calling learnFromResult..."),await j({success:!0,items_imported:e.reviewSummary.totalItems},e.userFeedback?{user_feedback:e.userFeedback}:void 0),console.log("[NEXO] approveAndImport: Import process completed!"),{isAsync:!1})},[e.sessionState,e.reviewSummary,e.answers,e.userFeedback,c,h,g,j]);return{state:e,isAnalyzing:t,isRecalling:r,hasQuestions:i,isReadyToProcess:n,isReviewing:o,startAnalysis:d,answerQuestion:m,submitAllAnswers:x,skipQuestions:u,approveAndImport:f,backToQuestions:p,prepareProcessing:h,executeNexoImport:g,learnFromResult:j,reset:(0,a.useCallback)(()=>{s(sI)},[]),reasoningTrace:e.analysis?.reasoningTrace||[],currentThought:l,priorKnowledge:e.priorKnowledge,reviewSummary:e.reviewSummary}}(),{registerJob:_}=(0,e2.useInventoryOperations)(),[C,k]=(0,a.useState)(!1),[E,S]=(0,a.useState)(0),A=[{text:"Analisando estrutura do arquivo...",emoji:"🔍"},{text:"Identificando colunas e campos...",emoji:"📋"},{text:"Consultando base de conhecimento...",emoji:"🧠"},{text:"Processando com IA generativa...",emoji:"✨"},{text:"Mapeando dados para o sistema...",emoji:"🗺️"},{text:"Verificando padrões anteriores...",emoji:"📊"},{text:"Preparando perguntas de validação...",emoji:"❓"},{text:"Quase lá, finalizando análise...",emoji:"🎯"}];(0,a.useEffect)(()=>{if(!c&&!d)return void S(0);let e=setInterval(()=>{S(e=>(e+1)%A.length)},4e3);return()=>clearInterval(e)},[c,d,A.length]),(0,a.useEffect)(()=>{e&&"idle"===o.stage&&p(e).catch(e=>{console.error("[NEXO] Analysis failed:",e)})},[e,o.stage,p]);let q=async(e="",s)=>{k(!0);try{await g(e||void 0,s)}finally{k(!1)}},I=async()=>{k(!0);try{let e=await f();if(e.isAsync&&e.jobId){let s={job_id:e.jobId,type:"smart_import",title:`Importa\xe7\xe3o: ${o.analysis?.filename||"arquivo"}`,status:"queued",message:e.humanMessage||"Processando em segundo plano",started_at:new Date().toISOString(),metadata:{filename:o.analysis?.filename,session_id:o.analysis?.sessionId}};_(s),(0,sP.toast)({title:"NEXO assumiu a importação",description:"Você será notificado quando terminar. Pode continuar trabalhando.",duration:6e3}),t(o.analysis.sessionId);return}t(o.analysis.sessionId)}catch(s){console.error("[NEXO] Import failed:",s);let e=s instanceof Error?s.message:"Erro ao executar importação";(0,sP.toast)({title:"Falha na importação",description:e,variant:"destructive",duration:8e3})}finally{k(!1)}},P=async()=>{k(!0);try{await j()}finally{k(!1)}},O=async()=>{k(!0);try{if(!w)throw Error("Sessão de revisão não encontrada. Por favor, responda às perguntas novamente.");let e=await f();if(e.isAsync&&e.jobId){let s={job_id:e.jobId,type:"smart_import",title:`Importa\xe7\xe3o: ${o.analysis?.filename||"arquivo"}`,status:"queued",message:e.humanMessage||"Processando em segundo plano",started_at:new Date().toISOString(),metadata:{filename:o.analysis?.filename,session_id:o.analysis?.sessionId}};_(s),(0,sP.toast)({title:"NEXO assumiu a importação",description:"Você será notificado quando terminar. Pode continuar trabalhando.",duration:6e3}),t(o.analysis.sessionId);return}t(o.analysis.sessionId)}catch(s){console.error("[NEXO] Import failed:",s);let e=s instanceof Error?s.message:"Erro ao executar importação";(0,sP.toast)({title:"Falha na importação",description:e,variant:"destructive",duration:8e3})}finally{k(!1)}},B="re-analyzing"===o.stage;if("uploading"===o.stage||d||c||B){let a={uploading:{title:"Enviando Arquivo",gradient:"from-cyan-500 to-blue-500"},recalling:{title:"NEXO Consultando Memória",gradient:"from-purple-500 to-pink-500"},analyzing:{title:"NEXO Analisando com IA",gradient:"from-purple-500 to-pink-500"},"re-analyzing":{title:"NEXO Reavaliando Respostas",gradient:"from-orange-500 to-red-500"}},{title:t,gradient:n}=a[o.stage]||a.analyzing,l=A[E];return(0,s.jsxs)(L.GlassCard,{children:[(0,s.jsx)(L.GlassCardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(i.motion.div,{animate:{rotate:360},transition:{duration:3,repeat:1/0,ease:"linear"},className:`p-1.5 rounded-lg bg-gradient-to-br ${n}`,children:(0,s.jsx)(R.Brain,{className:"w-5 h-5 text-white"})}),(0,s.jsx)(L.GlassCardTitle,{children:t})]})}),(0,s.jsx)(L.GlassCardContent,{children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4 py-4",children:[(0,s.jsx)(i.motion.div,{animate:{scale:[1,1.1,1],opacity:[.7,1,.7]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},className:`w-20 h-20 rounded-2xl bg-gradient-to-br ${n} flex items-center justify-center shadow-lg shadow-purple-500/25`,children:(0,s.jsx)(R.Brain,{className:"w-10 h-10 text-white"})}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-text-primary truncate max-w-[200px]",children:e?.name}),(0,s.jsx)("p",{className:"text-xs text-text-muted",children:e?.size?`${(e.size/1024).toFixed(1)} KB`:""})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(e6,{value:o.progress.percent,className:"h-2"}),(0,s.jsxs)("p",{className:"text-xs text-text-muted text-center",children:[o.progress.percent,"% concluído"]})]}),(0,s.jsx)(r.AnimatePresence,{mode:"wait",children:(0,s.jsx)(i.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:`flex items-center justify-center gap-2 p-3 rounded-lg border ${B?"bg-orange-500/10 border-orange-500/20":"bg-purple-500/10 border-purple-500/20"}`,children:B?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"text-lg",children:"🔄"}),(0,s.jsx)("p",{className:"text-sm text-text-secondary",children:o.progress.message})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"text-lg",children:l.emoji}),(0,s.jsx)("p",{className:"text-sm text-text-secondary",children:l.text})]})},B?o.progress.message:E)}),N&&(0,s.jsxs)(i.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex items-start gap-2 p-3 bg-cyan-500/10 rounded-lg border border-cyan-500/20",children:[(0,s.jsx)(ei.Lightbulb,{className:"w-4 h-4 text-cyan-400 flex-shrink-0 mt-0.5"}),(0,s.jsx)("p",{className:"text-sm text-text-secondary",children:N})]}),(0,s.jsxs)("div",{className:"space-y-3 pt-2",children:[(0,s.jsx)("p",{className:"text-xs text-text-muted font-medium uppercase tracking-wide",children:"Prévia do resultado"}),(0,s.jsxs)("div",{className:"p-3 bg-white/5 rounded-lg border border-white/10 space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(e7.Skeleton,{className:"h-4 w-4 rounded"}),(0,s.jsx)(e7.Skeleton,{className:"h-4 w-24"}),(0,s.jsx)(e7.Skeleton,{className:"h-4 w-16 ml-auto"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,s.jsx)(e7.Skeleton,{className:"h-8 rounded"}),(0,s.jsx)(e7.Skeleton,{className:"h-8 rounded"}),(0,s.jsx)(e7.Skeleton,{className:"h-8 rounded"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,s.jsx)(e7.Skeleton,{className:"h-8 rounded"}),(0,s.jsx)(e7.Skeleton,{className:"h-8 rounded"}),(0,s.jsx)(e7.Skeleton,{className:"h-8 rounded"})]}),(0,s.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,s.jsx)(e7.Skeleton,{className:"h-9 flex-1 rounded-lg"}),(0,s.jsx)(e7.Skeleton,{className:"h-9 w-24 rounded-lg"})]})]})]})]})})]})}return"error"===o.stage?(0,s.jsxs)(L.GlassCard,{children:[(0,s.jsx)(L.GlassCardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(J.AlertTriangle,{className:"w-5 h-5 text-red-400"}),(0,s.jsx)(L.GlassCardTitle,{children:"Erro na Análise"})]})}),(0,s.jsx)(L.GlassCardContent,{children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(sB,{summary:sQ.summary,details:sQ.details,action:sQ.action,variant:"warning"}),o.debugAnalysis?(0,s.jsx)(ef,{analysis:o.debugAnalysis,defaultExpanded:!0,className:"my-4"}):(0,s.jsx)("p",{className:"text-sm text-red-400",children:o.error}),(0,s.jsx)(l.Button,{variant:"outline",onClick:n,children:"Tentar novamente"})]})})]}):"complete"===o.stage?(0,s.jsxs)(L.GlassCard,{children:[(0,s.jsx)(L.GlassCardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(i.motion.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200,damping:15},className:"p-1.5 rounded-lg bg-gradient-to-br from-green-500 to-cyan-500",children:(0,s.jsx)(T.CheckCircle2,{className:"w-5 h-5 text-white"})}),(0,s.jsx)(L.GlassCardTitle,{children:"Importação Concluída!"})]})}),(0,s.jsx)(L.GlassCardContent,{children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)(i.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center py-6",children:[(0,s.jsx)(i.motion.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring",stiffness:200},className:"w-20 h-20 mx-auto mb-4 rounded-full bg-gradient-to-br from-green-500/20 to-cyan-500/20 flex items-center justify-center",children:(0,s.jsx)(T.CheckCircle2,{className:"w-10 h-10 text-green-400"})}),(0,s.jsx)("h3",{className:"text-xl font-semibold text-text-primary mb-2",children:"Dados Importados com Sucesso!"}),(0,s.jsx)("p",{className:"text-text-muted",children:w?.totalItems?`${w.totalItems.toLocaleString()} itens foram adicionados \xe0s entradas pendentes`:"Os dados foram processados e estão aguardando revisão"})]}),w&&(0,s.jsxs)(i.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},className:"p-4 bg-white/5 rounded-lg border border-white/10 space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(eE.FileSpreadsheet,{className:"w-5 h-5 text-cyan-400"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:w.filename}),(0,s.jsx)("p",{className:"text-sm text-text-muted",children:w.mainSheet})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 pt-3 border-t border-white/10",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-text-muted",children:"Itens importados"}),(0,s.jsx)("p",{className:"text-xl font-bold text-green-400",children:w.totalItems.toLocaleString()})]}),w.projectName&&(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-text-muted",children:"Projeto"}),(0,s.jsx)("p",{className:"text-lg font-medium",children:w.projectName})]})]}),w.newColumns&&w.newColumns.length>0&&(0,s.jsxs)("div",{className:"pt-3 border-t border-white/10",children:[(0,s.jsxs)("p",{className:"text-sm text-text-muted mb-2 flex items-center gap-2",children:[(0,s.jsx)(e5,{className:"w-4 h-4 text-purple-400"}),"Novos campos criados:"]}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:w.newColumns.map((e,a)=>(0,s.jsxs)($.Badge,{className:"bg-purple-500/20 text-purple-400",children:[e.name," (",e.inferredType,")"]},a))})]})]}),(0,s.jsx)(sB,{summary:sK.summary,details:sK.details,action:sK.action,variant:"success"}),(0,s.jsx)("div",{className:"flex justify-center gap-3 pt-4",children:(0,s.jsxs)(l.Button,{onClick:n,className:"bg-gradient-to-r from-cyan-500 to-purple-500 text-white",children:[(0,s.jsx)(eE.FileSpreadsheet,{className:"w-4 h-4 mr-2"}),"Nova Importação"]})})]})})]}):o.analysis?(0,s.jsxs)(L.GlassCard,{children:[(0,s.jsx)(L.GlassCardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(R.Brain,{className:"w-5 h-5 text-purple-400"}),(0,s.jsx)(L.GlassCardTitle,{children:"Análise NEXO"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)($.Badge,{className:o.analysis.overallConfidence>=.8?"bg-green-500/20 text-green-400":o.analysis.overallConfidence>=.5?"bg-yellow-500/20 text-yellow-400":"bg-red-500/20 text-red-400",title:"Qualidade do arquivo (estrutura, formato, legibilidade)",children:["📄 ",Math.round(100*o.analysis.overallConfidence),"%"]}),(0,s.jsx)($.Badge,{className:o.analysis.mappingComplete?void 0!==o.analysis.mappingConfidence&&o.analysis.mappingConfidence>=.8?"bg-blue-500/20 text-blue-400":void 0!==o.analysis.mappingConfidence&&o.analysis.mappingConfidence>=.5?"bg-yellow-500/20 text-yellow-400":"bg-orange-500/20 text-orange-400":"bg-purple-500/20 text-purple-400 animate-pulse",title:o.analysis.mappingComplete?"Confiança no mapeamento de colunas para o schema do banco":"Aguardando mapeamento de colunas...",children:o.analysis.mappingComplete?`🔗 ${Math.round((o.analysis.mappingConfidence??0)*100)}%`:"🔗 Pendente..."})]})]})}),(0,s.jsx)(L.GlassCardContent,{children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-white/5 rounded-lg",children:[(0,s.jsx)(eE.FileSpreadsheet,{className:"w-5 h-5 text-cyan-400"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:o.analysis.filename}),(0,s.jsxs)("p",{className:"text-sm text-text-muted",children:[o.analysis.detectedType.toUpperCase()," · ",o.analysis.recommendedStrategy]})]})]}),y&&y.similar_episodes>0&&(0,s.jsxs)(i.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"p-4 bg-gradient-to-r from-purple-500/10 to-cyan-500/10 rounded-lg border border-purple-500/20",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,s.jsx)(eo.History,{className:"w-4 h-4 text-purple-400"}),(0,s.jsx)("span",{className:"font-medium text-sm",children:"Conhecimento Prévio Encontrado"}),(0,s.jsxs)($.Badge,{className:"bg-purple-500/20 text-purple-400 text-xs",children:[y.similar_episodes," importações similares"]})]}),(0,s.jsx)(sB,{summary:sJ(y.similar_episodes).summary,details:sJ(y.similar_episodes).details,action:sJ(y.similar_episodes).action,variant:"success",compact:!0}),Object.keys(y.suggested_mappings).length>0&&(0,s.jsxs)("div",{className:"flex items-center gap-4 text-sm mb-2 mt-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(eF.TrendingUp,{className:"w-4 h-4 text-cyan-400"}),(0,s.jsxs)("span",{className:"text-text-secondary",children:[Object.keys(y.suggested_mappings).length," mapeamentos sugeridos"]})]}),y.confidence_boost&&(0,s.jsx)($.Badge,{className:"bg-green-500/20 text-green-400 text-xs",children:"+15% confiança"})]}),y.reflections.length>0&&(0,s.jsxs)("div",{className:"mt-3 pt-3 border-t border-white/10",children:[(0,s.jsxs)("p",{className:"text-xs text-text-muted mb-2 flex items-center gap-1",children:[(0,s.jsx)(W.Sparkles,{className:"w-3 h-3"}),"Aprendizados de importações anteriores:"]}),(0,s.jsx)("ul",{className:"space-y-1",children:y.reflections.slice(0,2).map((e,a)=>(0,s.jsxs)("li",{className:"text-xs text-text-secondary flex items-start gap-2",children:[(0,s.jsx)("span",{className:"text-purple-400",children:"•"}),e]},a))})]})]}),(!y||0===y.similar_episodes)&&(0,s.jsx)(i.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"space-y-3",children:(0,s.jsx)(sB,{summary:sJ(0).summary,details:sJ(0).details,action:sJ(0).action,variant:"info",compact:!0})}),(0,s.jsx)(sW,{steps:v}),o.analysis.sheets.length>0&&(0,s.jsx)(sZ,{sheets:o.analysis.sheets}),o.analysis.columnMappings.length>0&&(0,s.jsx)(sY,{mappings:o.analysis.columnMappings}),m&&(0,s.jsx)(s0,{questions:o.questions,answers:o.answers,onAnswer:h,onSubmit:q,onSkip:P,isSubmitting:C}),u&&w&&(0,s.jsx)(s5,{reviewSummary:w,userFeedback:o.userFeedback,onApprove:I,onBack:()=>{b()},onCancel:n,isSubmitting:C}),x&&!m&&!u&&w&&(0,s.jsxs)("div",{className:"flex justify-end gap-3 pt-4 border-t border-white/10",children:[(0,s.jsx)(l.Button,{variant:"outline",onClick:n,children:"Cancelar"}),(0,s.jsx)(l.Button,{onClick:O,disabled:C,className:"bg-gradient-to-r from-cyan-500 to-purple-500 text-white",children:C?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eM.Loader2,{className:"w-4 h-4 mr-2 animate-spin"}),"Preparando..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(T.CheckCircle2,{className:"w-4 h-4 mr-2"}),"Continuar para importação"]})})]})]})})]}):null}function s8(){let[e,o]=(0,a.useState)("smart"),[c,d]=(0,a.useState)(null),{detectedType:m,isProcessing:x,progress:u,error:p,preview:h,uploadAndProcess:g,clearPreview:j,confirmEntry:f,pendingEntries:b,pendingEntriesLoading:v,assignProject:N,useNexoFlow:y,setUseNexoFlow:w}=(0,X.useSmartImporter)(),{projects:_,locations:C,partNumbers:q}=(0,M.useAssetManagement)(),{isProcessing:L,error:$,submitEntry:z}=(0,G.useManualEntry)(),[U,V]=(0,a.useState)(!1),[H,Q]=(0,a.useState)(null),[K,J]=(0,a.useState)(""),[W,Z]=(0,a.useState)(!1),Y=async()=>{if(H&&K){Z(!0);try{await N(H,K),V(!1),Q(null),J("")}catch{}finally{Z(!1)}}},ee=async(e,s,a)=>{e.name.endsWith(".xlsx")||e.name.endsWith(".csv")?(console.log("[EntradaPage] AI-First: NEXO autonomous analysis for:",e.name),d(e)):await g(e,s,a)},es=async e=>{switch(console.log("[EntradaPage] Debug action:",e),p?.debug_analysis&&(0,D.recordDebugAction)({action:e,error_signature:p.debug_analysis.error_signature||"unknown",error_type:p.debug_analysis.error_type||"unknown",suggested_action:p.debug_analysis.suggested_action||"retry",..."escalate"===e&&{debug_analysis:p.debug_analysis}}).catch(e=>{console.warn("[EntradaPage] Failed to record debug action:",e)}),e){case"retry":break;case"escalate":console.log("[EntradaPage] Escalation logged for batch review");break;case"fallback":o("manual");break;case"abort":j()}},ea=async()=>{await f()},et=async e=>{await z(e)};return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"flex items-center gap-2 mb-2",children:(0,s.jsx)(l.Button,{variant:"ghost",size:"sm",asChild:!0,children:(0,s.jsxs)(t.default,{href:"/ferramentas/ativos/estoque/movimentacoes",children:[(0,s.jsx)(S.ArrowLeft,{className:"w-4 h-4 mr-1"}),"Movimentacoes"]})})}),(0,s.jsx)("h1",{className:"text-xl font-semibold text-text-primary",children:"Entrada de Materiais"}),(0,s.jsx)("p",{className:"text-sm text-text-muted mt-1",children:"Upload inteligente ou entrada manual"})]})}),(0,s.jsxs)(n.Tabs,{value:e,onValueChange:e=>o(e),children:[(0,s.jsxs)(n.TabsList,{className:"w-full grid grid-cols-2 bg-white/5 p-1 rounded-lg",children:[(0,s.jsxs)(n.TabsTrigger,{value:"smart",className:"flex items-center gap-2 data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-mid/20 data-[state=active]:to-magenta-mid/20 data-[state=active]:text-blue-light",children:[(0,s.jsx)(A.Upload,{className:"w-4 h-4"}),(0,s.jsx)("span",{children:"Upload Inteligente"})]}),(0,s.jsxs)(n.TabsTrigger,{value:"manual",className:"flex items-center gap-2 data-[state=active]:bg-purple-500/20 data-[state=active]:text-purple-400",children:[(0,s.jsx)(I,{className:"w-4 h-4"}),(0,s.jsx)("span",{children:"Manual"})]})]}),(0,s.jsxs)(n.TabsContent,{value:"smart",className:"mt-6 space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-purple-500/10 to-cyan-500/10 rounded-lg border border-purple-500/20",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(R.Brain,{className:"w-5 h-5 text-purple-400"}),(0,s.jsxs)("div",{children:[(0,s.jsx)(E.Label,{htmlFor:"nexo-toggle",className:"text-sm font-medium text-text-primary cursor-pointer",children:"Importação Inteligente com NEXO"}),(0,s.jsx)("p",{className:"text-xs text-text-muted",children:"NEXO analisa e faz perguntas para mapear colunas automaticamente"})]})]}),(0,s.jsx)(k,{id:"nexo-toggle",checked:y,onCheckedChange:w})]}),c?(0,s.jsx)(s3,{file:c,onComplete:e=>{console.log("[EntradaPage] NEXO import complete, session:",e)},onCancel:()=>{console.log("[EntradaPage] NEXO analysis cancelled"),d(null)}}):h?(0,s.jsx)(eL,{preview:h,onConfirm:ea,onCancel:j}):(0,s.jsx)(ev,{onFileSelect:ee,isProcessing:x,progress:u,error:p,detectedType:m,onDebugAction:es})]}),(0,s.jsx)(n.TabsContent,{value:"manual",className:"mt-6",children:(0,s.jsx)(eJ,{isProcessing:L,error:$,projects:_,locations:C,partNumbers:q,onSubmit:et,onClear:()=>{}})})]}),!h&&b.length>0&&(0,s.jsx)(eW,{entries:b,isLoading:v,onAssignProject:e=>{Q(e),J(""),V(!0)},onReview:e=>console.log("Review entry:",e)}),(0,s.jsx)(r.AnimatePresence,{children:U&&(0,s.jsx)(i.motion.div,{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>!W&&V(!1),children:(0,s.jsxs)(i.motion.div,{className:"bg-surface-elevated border border-border rounded-xl p-6 w-full max-w-md mx-4 shadow-xl",initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded-full bg-orange-500/20 flex items-center justify-center",children:(0,s.jsx)(O,{className:"w-5 h-5 text-orange-400"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-text-primary",children:"Atribuir Projeto"}),(0,s.jsx)("p",{className:"text-xs text-text-muted",children:"Selecione o projeto para esta entrada"})]})]}),(0,s.jsx)("button",{onClick:()=>!W&&V(!1),className:"p-2 hover:bg-white/10 rounded-lg transition-colors",disabled:W,children:(0,s.jsx)(P.X,{className:"w-5 h-5 text-text-muted"})})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("label",{className:"text-sm font-medium text-text-primary mb-2 block",children:[(0,s.jsx)(F.Briefcase,{className:"w-4 h-4 inline mr-2"}),"Projeto"]}),(0,s.jsxs)("select",{className:"w-full px-3 py-2 bg-white/5 border border-border rounded-md text-sm text-text-primary",value:K,onChange:e=>J(e.target.value),disabled:W,children:[(0,s.jsx)("option",{value:"",children:"Selecione o projeto..."}),_.filter(e=>e.is_active).map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.code," - ",e.name]},e.id))]})]}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)(l.Button,{variant:"outline",className:"flex-1",onClick:()=>V(!1),disabled:W,children:"Cancelar"}),(0,s.jsx)(l.Button,{className:"flex-1 bg-orange-500 hover:bg-orange-600",onClick:Y,disabled:!K||W,children:W?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(B.RefreshCw,{className:"w-4 h-4 mr-2 animate-spin"}),"Atribuindo..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(T.CheckCircle2,{className:"w-4 h-4 mr-2"}),"Atribuir Projeto"]})})]})]})})})]})}e.i(45680),e.i(86914),R.Brain,e3.Play,e1.Eye,e.s(["default",()=>s8],8056)}]);