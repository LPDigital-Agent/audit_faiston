(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,4370,e=>{"use strict";var t=e.i(49973),s=e.i(47163),r=e.i(69742);let i={none:"",sm:"p-3",md:"p-4",lg:"p-6"};function a({ref:e,className:a,elevated:l=!1,gradientBorder:n=!1,hoverGlow:c=!0,padding:d="md",children:o,...h}){return(0,t.jsx)(r.motion.div,{ref:e,initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3,ease:"easeOut"},className:(0,s.cn)(l?"glass-elevated":"glass-card",i[d],c&&"ghost-border",n&&"gradient-border","transition-all duration-200",a),...h,children:o})}function l({className:e,children:r,...i}){return(0,t.jsx)("div",{className:(0,s.cn)("flex items-center justify-between mb-4",e),...i,children:r})}function n({className:e,children:r,...i}){return(0,t.jsx)("h3",{className:(0,s.cn)("text-h2 text-text-primary",e),...i,children:r})}function c({className:e,children:r,...i}){return(0,t.jsx)("div",{className:(0,s.cn)("text-body text-text-secondary",e),...i,children:r})}e.s(["GlassCard",()=>a,"GlassCardContent",()=>c,"GlassCardHeader",()=>l,"GlassCardTitle",()=>n])},66974,e=>{"use strict";let t=(0,e.i(98631).default)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);e.s(["RefreshCw",()=>t],66974)},30209,e=>{"use strict";var t=e.i(18939),s=e.i(99973),r=e.i(89747),i=e.i(79743),a=e.i(4039),l=class extends i.Subscribable{#e;#t=void 0;#s;#r;constructor(e,t){super(),this.#e=e,this.setOptions(t),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){let t=this.options;this.options=this.#e.defaultMutationOptions(e),(0,a.shallowEqualObjects)(this.options,t)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#s,observer:this}),t?.mutationKey&&this.options.mutationKey&&(0,a.hashKey)(t.mutationKey)!==(0,a.hashKey)(this.options.mutationKey)?this.reset():this.#s?.state.status==="pending"&&this.#s.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#s?.removeObserver(this)}onMutationUpdate(e){this.#i(),this.#a(e)}getCurrentResult(){return this.#t}reset(){this.#s?.removeObserver(this),this.#s=void 0,this.#i(),this.#a()}mutate(e,t){return this.#r=t,this.#s?.removeObserver(this),this.#s=this.#e.getMutationCache().build(this.#e,this.options),this.#s.addObserver(this),this.#s.execute(e)}#i(){let e=this.#s?.state??(0,s.getDefaultState)();this.#t={...e,isPending:"pending"===e.status,isSuccess:"success"===e.status,isError:"error"===e.status,isIdle:"idle"===e.status,mutate:this.mutate,reset:this.reset}}#a(e){r.notifyManager.batch(()=>{if(this.#r&&this.hasListeners()){let t=this.#t.variables,s=this.#t.context,r={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#r.onSuccess?.(e.data,t,s,r),this.#r.onSettled?.(e.data,null,t,s,r)):e?.type==="error"&&(this.#r.onError?.(e.error,t,s,r),this.#r.onSettled?.(void 0,e.error,t,s,r))}this.listeners.forEach(e=>{e(this.#t)})})}},n=e.i(63257);function c(e,s){let i=(0,n.useQueryClient)(s),[c]=t.useState(()=>new l(i,e));t.useEffect(()=>{c.setOptions(e)},[c,e]);let d=t.useSyncExternalStore(t.useCallback(e=>c.subscribe(r.notifyManager.batchCalls(e)),[c]),()=>c.getCurrentResult(),()=>c.getCurrentResult()),o=t.useCallback((e,t)=>{c.mutate(e,t).catch(a.noop)},[c]);if(d.error&&(0,a.shouldThrowError)(c.options.throwOnError,[d.error]))throw d.error;return{...d,mutate:o,mutateAsync:d.mutate}}e.s(["useMutation",()=>c],30209)},54754,e=>{"use strict";let t=(0,e.i(98631).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],54754)},23753,e=>{"use strict";let t=(0,e.i(98631).default)("arrow-right-left",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]);e.s(["ArrowRightLeft",()=>t],23753)},53668,e=>{"use strict";let t=(0,e.i(98631).default)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);e.s(["XCircle",()=>t],53668)},21748,e=>{"use strict";let t=(0,e.i(98631).default)("file-spreadsheet",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);e.s(["FileSpreadsheet",()=>t],21748)},72706,e=>{"use strict";let t=(0,e.i(98631).default)("settings-2",[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]);e.s(["Settings2",()=>t],72706)},31490,e=>{"use strict";var t=e.i(49973),s=e.i(18939),r=e.i(91514),i=e.i(30209),a=e.i(4370),l=e.i(67881),n=e.i(94179),c=e.i(23753),d=e.i(54754),o=e.i(21748),h=e.i(21172),x=e.i(29126),m=e.i(53668),u=e.i(66974),p=e.i(16024),j=e.i(72706),y=e.i(23145),g=e.i(98631);let b=(0,g.default)("circle-minus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}]]),f=(0,g.default)("circle-plus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);var N=e.i(64583);function v(){let[e,g]=(0,s.useState)(null),[v,C]=(0,s.useState)([]),[S,A]=(0,s.useState)(null),[k,M]=(0,s.useState)(null),[R,G]=(0,s.useState)({}),E=(0,i.useMutation)({mutationFn:async e=>(await (0,N.reconcileSAPExport)({sap_data:e})).data,onSuccess:e=>{M(e),G({})}}),O=(0,i.useMutation)({mutationFn:async({deltaId:e,action:t,reason:s})=>(await (0,N.applyReconciliationAction)({delta_id:e,action:t,reason:s})).data,onSuccess:e=>{G(t=>({...t,[e.delta_id]:e.message}))}}),q=(0,s.useCallback)(e=>{let t=e.target.files?.[0];if(!t)return;g(t),A(null),M(null),G({});let s=new FileReader;s.onload=e=>{try{let t=e.target?.result,s=function(e){let t=e.trim().split("\n");if(t.length<2)return[];let s=t[0].split(/[,;]/).map(e=>e.trim().toLowerCase()),r=s.findIndex(e=>["part_number","pn","codigo","material","matnr"].includes(e)),i=s.findIndex(e=>["location","loc","deposito","lgort","local"].includes(e)),a=s.findIndex(e=>["quantity","qty","quantidade","menge","qtd"].includes(e)),l=s.findIndex(e=>["serial","sn","serie","sernr"].includes(e)),n=s.findIndex(e=>["description","desc","descricao","maktx","nome"].includes(e));if(r<0||i<0||a<0)throw Error("CSV deve conter colunas: part_number, location, quantity");let c=[];for(let e=1;e<t.length;e++){let s=t[e].split(/[,;]/).map(e=>e.trim());s.length<3||c.push({part_number:s[r],location:s[i],quantity:parseFloat(s[a])||0,serial:l>=0?s[l]:void 0,description:n>=0?s[n]:void 0})}return c}(t);C(s)}catch(e){A(e.message),C([])}},s.readAsText(t)},[]),_=(e,t)=>{O.mutate({deltaId:e,action:t})};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"flex items-center gap-2 mb-2",children:(0,t.jsx)(l.Button,{variant:"ghost",size:"sm",asChild:!0,children:(0,t.jsxs)(r.default,{href:"/ferramentas/ativos/estoque",children:[(0,t.jsx)(d.ArrowLeft,{className:"w-4 h-4 mr-1"}),"Estoque"]})})}),(0,t.jsxs)("h1",{className:"text-xl font-semibold text-text-primary flex items-center gap-2",children:[(0,t.jsx)(c.ArrowRightLeft,{className:"w-5 h-5 text-blue-400"}),"Reconciliação SAP"]}),(0,t.jsx)("p",{className:"text-sm text-text-muted mt-1",children:"Compare estoque SAP com SGA e identifique divergências"})]}),(0,t.jsx)(l.Button,{variant:"outline",size:"sm",asChild:!0,children:(0,t.jsxs)(r.default,{href:"/ferramentas/ativos/estoque/analytics",children:[(0,t.jsx)(j.Settings2,{className:"w-4 h-4 mr-2"}),"Ver Métricas"]})})]}),(0,t.jsxs)(a.GlassCard,{children:[(0,t.jsx)(a.GlassCardHeader,{children:(0,t.jsx)(a.GlassCardTitle,{children:"1. Upload do Relatório SAP"})}),(0,t.jsx)(a.GlassCardContent,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("p",{className:"text-sm text-text-muted",children:["Exporte um relatório de estoque do SAP em formato CSV contendo as colunas:",(0,t.jsx)("span",{className:"font-mono text-xs ml-2",children:"part_number, location, quantity"})]}),(0,t.jsxs)("div",{className:"border-2 border-dashed border-border rounded-lg p-8 text-center hover:border-blue-500/50 transition-colors",children:[(0,t.jsx)("input",{type:"file",accept:".csv,.txt",onChange:q,className:"hidden",id:"csv-upload"}),(0,t.jsxs)("label",{htmlFor:"csv-upload",className:"cursor-pointer",children:[(0,t.jsx)(o.FileSpreadsheet,{className:"w-12 h-12 text-text-muted mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-sm text-text-primary mb-2",children:e?e.name:"Clique para selecionar arquivo CSV"}),(0,t.jsx)("p",{className:"text-xs text-text-muted",children:"Suporta .csv e .txt com delimitador vírgula ou ponto-e-vírgula"})]})]}),S&&(0,t.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-red-500/20 border border-red-500/30 rounded-lg",children:[(0,t.jsx)(h.AlertTriangle,{className:"w-4 h-4 text-red-400"}),(0,t.jsx)("p",{className:"text-sm text-red-400",children:S})]}),v.length>0&&(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(n.Badge,{variant:"outline",className:"text-green-400 border-green-400",children:[(0,t.jsx)(x.CheckCircle2,{className:"w-3 h-3 mr-1"}),v.length," itens carregados"]}),(0,t.jsx)(l.Button,{onClick:()=>{0!==v.length&&E.mutate(v)},disabled:E.isPending,children:E.isPending?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.RefreshCw,{className:"w-4 h-4 mr-2 animate-spin"}),"Comparando..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.Search,{className:"w-4 h-4 mr-2"}),"Iniciar Reconciliação"]})})]}),(0,t.jsx)("div",{className:"max-h-48 overflow-auto border border-border rounded-lg",children:(0,t.jsxs)("table",{className:"w-full text-sm",children:[(0,t.jsx)("thead",{className:"bg-white/5 sticky top-0",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"text-left px-3 py-2 text-text-muted",children:"Part Number"}),(0,t.jsx)("th",{className:"text-left px-3 py-2 text-text-muted",children:"Location"}),(0,t.jsx)("th",{className:"text-right px-3 py-2 text-text-muted",children:"Qty"})]})}),(0,t.jsxs)("tbody",{children:[v.slice(0,10).map((e,s)=>(0,t.jsxs)("tr",{className:"border-t border-border",children:[(0,t.jsx)("td",{className:"px-3 py-2 text-text-primary",children:e.part_number}),(0,t.jsx)("td",{className:"px-3 py-2 text-text-primary",children:e.location}),(0,t.jsx)("td",{className:"px-3 py-2 text-text-primary text-right",children:e.quantity})]},s)),v.length>10&&(0,t.jsx)("tr",{className:"border-t border-border",children:(0,t.jsxs)("td",{colSpan:3,className:"px-3 py-2 text-text-muted text-center",children:["... e mais ",v.length-10," itens"]})})]})]})})]})]})})]}),E.error&&(0,t.jsxs)("div",{className:"flex items-center gap-2 p-4 bg-red-500/20 border border-red-500/30 rounded-lg",children:[(0,t.jsx)(h.AlertTriangle,{className:"w-5 h-5 text-red-400"}),(0,t.jsxs)("p",{className:"text-sm text-red-400",children:["Erro na reconciliação: ",E.error.message]})]}),k&&(0,t.jsxs)(a.GlassCard,{children:[(0,t.jsx)(a.GlassCardHeader,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(a.GlassCardTitle,{children:"2. Resultado da Reconciliação"}),(0,t.jsxs)(n.Badge,{variant:"outline",children:["ID: ",k.reconciliation_id]})]})}),(0,t.jsxs)(a.GlassCardContent,{children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4 mb-6",children:[(0,t.jsxs)("div",{className:"p-4 bg-white/5 rounded-lg text-center",children:[(0,t.jsx)("p",{className:"text-2xl font-bold text-text-primary",children:k.total_sap_items}),(0,t.jsx)("p",{className:"text-xs text-text-muted",children:"Itens SAP"})]}),(0,t.jsxs)("div",{className:"p-4 bg-white/5 rounded-lg text-center",children:[(0,t.jsxs)("p",{className:"text-2xl font-bold text-green-400",children:[k.match_rate.toFixed(1),"%"]}),(0,t.jsx)("p",{className:"text-xs text-text-muted",children:"Taxa de Match"})]}),(0,t.jsxs)("div",{className:"p-4 bg-red-500/10 border border-red-500/30 rounded-lg text-center",children:[(0,t.jsx)("p",{className:"text-2xl font-bold text-red-400",children:k.summary.falta_sga}),(0,t.jsx)("p",{className:"text-xs text-text-muted",children:"Falta no SGA"})]}),(0,t.jsxs)("div",{className:"p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg text-center",children:[(0,t.jsx)("p",{className:"text-2xl font-bold text-yellow-400",children:k.summary.sobra_sga}),(0,t.jsx)("p",{className:"text-xs text-text-muted",children:"Sobra no SGA"})]})]}),k.deltas.length>0?(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("h3",{className:"text-sm font-medium text-text-primary",children:["Divergências (",k.deltas.length,")"]}),(0,t.jsx)("div",{className:"space-y-2",children:k.deltas.map(e=>(0,t.jsx)(w,{delta:e,onAction:_,actionResult:R[e.id],isLoading:O.isPending},e.id))})]}):(0,t.jsxs)("div",{className:"flex items-center justify-center p-8 bg-green-500/10 border border-green-500/30 rounded-lg",children:[(0,t.jsx)(x.CheckCircle2,{className:"w-6 h-6 text-green-400 mr-2"}),(0,t.jsx)("p",{className:"text-green-400 font-medium",children:"Nenhuma divergência encontrada! SAP e SGA estão sincronizados."})]})]})]}),(0,t.jsxs)(a.GlassCard,{children:[(0,t.jsx)(a.GlassCardHeader,{children:(0,t.jsx)(a.GlassCardTitle,{children:"Instruções"})}),(0,t.jsx)(a.GlassCardContent,{children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-text-muted",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-text-primary mb-2",children:"Exportar do SAP"}),(0,t.jsxs)("ol",{className:"list-decimal list-inside space-y-1",children:[(0,t.jsx)("li",{children:"Acesse SAP via Skyone Autosky"}),(0,t.jsx)("li",{children:"Navegue até Estoque → Relatórios"}),(0,t.jsx)("li",{children:'Selecione "Posição de Estoque"'}),(0,t.jsx)("li",{children:"Exporte como CSV"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-text-primary mb-2",children:"Tipos de Divergência"}),(0,t.jsxs)("ul",{className:"space-y-1",children:[(0,t.jsxs)("li",{children:[(0,t.jsx)(b,{className:"w-3 h-3 inline text-red-400 mr-1"})," ",(0,t.jsx)("strong",{children:"FALTA_SGA"}),": Item existe no SAP mas não no SGA"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)(f,{className:"w-3 h-3 inline text-yellow-400 mr-1"})," ",(0,t.jsx)("strong",{children:"SOBRA_SGA"}),": Item existe no SGA mas não no SAP"]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-text-primary mb-2",children:"Ações Disponíveis"}),(0,t.jsxs)("ul",{className:"space-y-1",children:[(0,t.jsxs)("li",{children:[(0,t.jsx)(j.Settings2,{className:"w-3 h-3 inline text-blue-400 mr-1"})," ",(0,t.jsx)("strong",{children:"Criar Ajuste"}),": Gera movimento de ajuste"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)(m.XCircle,{className:"w-3 h-3 inline text-gray-400 mr-1"})," ",(0,t.jsx)("strong",{children:"Ignorar"}),": Marca como divergência conhecida"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)(y.Eye,{className:"w-3 h-3 inline text-yellow-400 mr-1"})," ",(0,t.jsx)("strong",{children:"Investigar"}),": Cria tarefa HIL"]})]})]})]})})]})]})}function w({delta:e,onAction:s,actionResult:r,isLoading:i}){let a="FALTA_SGA"===e.delta_type;return(0,t.jsx)("div",{className:`p-4 border rounded-lg ${r?"bg-green-500/5 border-green-500/30":a?"bg-red-500/5 border-red-500/30":"bg-yellow-500/5 border-yellow-500/30"}`,children:(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[a?(0,t.jsx)(b,{className:"w-5 h-5 text-red-400"}):(0,t.jsx)(f,{className:"w-5 h-5 text-yellow-400"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium text-text-primary",children:e.part_number}),(0,t.jsxs)("p",{className:"text-xs text-text-muted",children:[e.location," • SAP: ",e.sap_quantity," • SGA: ",e.sga_quantity," • Δ ",e.delta]})]}),(0,t.jsx)(n.Badge,{variant:"outline",className:a?"text-red-400 border-red-400":"text-yellow-400 border-yellow-400",children:e.delta_type})]}),r?(0,t.jsxs)("div",{className:"flex items-center gap-2 text-green-400",children:[(0,t.jsx)(x.CheckCircle2,{className:"w-4 h-4"}),(0,t.jsx)("span",{className:"text-sm",children:r})]}):(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(l.Button,{variant:"outline",size:"sm",onClick:()=>s(e.id,"CREATE_ADJUSTMENT"),disabled:i,children:[(0,t.jsx)(j.Settings2,{className:"w-3 h-3 mr-1"}),"Ajustar"]}),(0,t.jsxs)(l.Button,{variant:"ghost",size:"sm",onClick:()=>s(e.id,"IGNORE"),disabled:i,children:[(0,t.jsx)(m.XCircle,{className:"w-3 h-3 mr-1"}),"Ignorar"]}),(0,t.jsxs)(l.Button,{variant:"ghost",size:"sm",onClick:()=>s(e.id,"INVESTIGATE"),disabled:i,children:[(0,t.jsx)(y.Eye,{className:"w-3 h-3 mr-1"}),"Investigar"]})]})]})})}e.s(["default",()=>v],31490)}]);