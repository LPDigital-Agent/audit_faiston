# =============================================================================
# AgentCore Deployment Configuration - RepairAgent (The Software Surgeon)
# =============================================================================
# Purpose: Automated code repair specialist triggered by DebugAgent
#
# TRIGGER: DebugAgent returns suggested_action="repair" â†’ Cognitive middleware invokes
#
# CAPABILITIES:
# 1. Create safe Git branches (fix/BUG-XXX-description pattern)
# 2. Commit fixes with MANDATORY syntax validation
# 3. Create DRAFT PRs with security audit labels
# 4. Validate Python syntax via AST parsing
# 5. Run targeted tests for verification
#
# SAFETY RULES (IMMUTABLE):
# 1. NEVER commit to protected branches (main, master, prod, production)
# 2. ALWAYS validate syntax before committing
# 3. ALWAYS create DRAFT PRs (never auto-merge)
# 4. Maximum 3 repair attempts per error_signature
# 5. 5-minute cooldown between attempts
#
# Deploy command:
#   cd server/agentcore-inventory/agents/specialists/repair
#   agentcore deploy --profile faiston-aio
#
# Reference: https://aws.github.io/bedrock-agentcore-starter-toolkit/api-reference/cli.html
# =============================================================================

# Runtime configuration
runtime:
  id: faiston_sga_repair
  description: "RepairAgent - The Software Surgeon for Automated Code Repair"

  # Memory configuration (STM only - repairs are atomic operations)
  memory:
    type: stm  # No LTM needed - each repair is independent

  # Network configuration
  port: 9020

  # Scaling (Conservative - repairs are critical operations)
  scaling:
    min_instances: 0
    max_instances: 3  # Limited to prevent concurrent repairs to same codebase

  # Timeout settings (Repairs include git ops + tests)
  timeout:
    invoke_timeout_seconds: 300  # 5 minutes for git + validation + PR creation

  # Health check
  health_check:
    path: /health
    interval_seconds: 30

# Environment variables
environment:
  # AWS Configuration
  AWS_REGION: us-east-2
  AWS_ACCOUNT_ID: "377311924364"

  # S3 Bucket for documents
  DOCUMENTS_BUCKET: faiston-one-sga-documents-prod

  # GitHub Configuration (passed at runtime via secrets)
  # GITHUB_TOKEN: (from SSM/Secrets Manager)
  # GITHUB_REPO: (from environment)

  # Logging level
  LOG_LEVEL: INFO

  # Repair safety limits
  MAX_REPAIR_ATTEMPTS: "3"
  REPAIR_COOLDOWN_SECONDS: "300"

# Agent metadata
metadata:
  name: RepairAgent
  version: "2026-01-22"
  phase: "infrastructure-repair"
  owner: "faiston-sga-team"
  tags:
    - infrastructure
    - code-repair
    - git-operations
    - automated-pr
    - human-in-the-loop
    - gemini-pro
    - thinking-mode
    - security-audit
    - fail-closed
